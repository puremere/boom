
@using System.Web
@model banimo.ViewModel.PartnerOrders
@{
    Layout = "~/Views/Shared/_PartnerLayout.cshtml";
    ViewBag.Title = "مدیریت مطالب";

}

<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin="">
</script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
      integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
      crossorigin="" />
<script type="text/javascript">
    var mymap;
    var theMarker = {};

    function showLocation(lat, lon) {
        mymap = L.map('mapid', { attributionControl: false }).setView([lat, lon], 13);
        L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox/streets-v11',
            tileSize: 512,
            zoomOffset: -1,
            accessToken: 'pk.eyJ1IjoibWVyaW9saSIsImEiOiJja2p6dXhmdngwYmVvMnZwY2lyc2htNGxhIn0.Y9t__Bll6Fw9b9amb_rcHg',

        }).addTo(mymap);
        mymap.panTo(new L.LatLng(lat, lon));
        theMarker = L.marker([lat, lon]).addTo(mymap);

    }
    $("#mapid").height("250px");
</script>
<style>

    .nav-tabs {
        padding-right: 0px;
    }

        .nav-tabs li {
            float: right !important;
        }
</style>
<div class="row">
    <div class="col-sm-12">
        <!-- Details Start -->

        <div class="card">
            <div class="card-body">
                <div class="title-header option-title">
                    <h5>Search Panel</h5>
                </div>
                <div class="row">
                    <form>
                        <div class="col-lg-6 mb-4 row align-items-center" style="display:inline-block">
                            <label class="form-label-title  mb-0">Status :</label>
                            <div class="col-sm-10">
                                <select class="form-control" name="c" id="SearchCat">
                                    <option value="">Choose Status</option>
                                    <option value="0">Pending</option>
                                    <option value="1">Accepted</option>
                                    <option value="2">Rejected</option>
                                    <option value="3">Preparing</option>
                                    <option value="4">Sending</option>
                                    <option value="4">Delivered</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-lg-6 mb-4 row align-items-center" style="display:inline-block">
                            <label class="form-label-title  mb-0">Title :</label>
                            <div class="col-sm-10">
                                <input type="text" id="seachQuery" name="q" class="form-control col-md-7 col-xs-12">

                            </div>
                        </div>
                        <div class="col-lg-6 mb-4 row align-items-center" style="display:inline-block">
                            <label class="form-label-title  mb-0" style="white-space:nowrap">Time From :</label>
                            <div class="col-sm-10">
                                <input type="date" id="TimeFrom" name="tf" value="" class="form-control col-md-7 col-xs-12">

                            </div>
                        </div>
                        <div class="col-lg-6 mb-4 row align-items-center" style="display:inline-block">
                            <label class="form-label-title  mb-0">Time To :</label>
                            <div class="col-sm-10">
                                <input type="date" id="TimeTo" name="tt" value="" class="form-control col-md-7 col-xs-12">

                            </div>
                        </div>
                        <div class="col-lg-6 mb-4 row align-items-center" style="display:inline-block">
                            <div id="NewList" class="col-sm-10" style="   margin-top: 20px;">
                                <button class="btn btn-primary lgnsubmitt">Get Order List</button>
                            </div>
                        </div>

                    </form>


                </div>
            </div>

        </div>
    </div>
</div>
<div class="row">
    <div class="col-sm-12">
        <!-- Details Start -->

        <div class="card">
            <div id="prnt" class="card-body">
                <div class="title-header option-title">
                    <h5>Order List</h5>
                </div>
                <div  class="row" style="background-color:white; padding:10px; margin:0px;overflow-x:scroll">
                    <table class="table all-package theme-table table-product dataTable no-footer" id="table_id" style="margin-top:10px">
                        <thead>

                            <tr>
                                <th class="sorting_disabled" rowspan="1" colspan="1" style="width: 170px;">Col</th>
                                <th class="sorting_disabled" rowspan="1" colspan="1" style="width: 170px;">Order Number</th>
                                <th class="sorting_disabled" rowspan="1" colspan="1" style="width: 170px;">Date</th>
                                <th class="sorting_disabled" rowspan="1" colspan="1" style="width: 170px;">User Address</th>
                                <th class="sorting_disabled" rowspan="1" colspan="1" style="width: 170px;">User Name</th>
                                <th class="sorting_disabled" rowspan="1" colspan="1" style="width: 170px;">User Phone</th>
                                <th class="sorting_disabled" rowspan="1" colspan="1" style="width: 170px;">Status</th>
                                <th class="sorting_disabled" rowspan="1" colspan="1" style="width: 170px;">actions</th>
                            </tr>
                        </thead>

                        <tbody>
                            @if (Model.partnerOrders != null)
                            {
                                List<banimo.ViewModel.PartnerOrder> lst = Model.partnerOrders.GroupBy(x => x.orderID).Select(x => x.First()).ToList();
                                foreach (var prod in lst)
                                {
                                    string addson = @prod.addson == null ? "" : @prod.addson;
                                    int i = lst.IndexOf(prod) + 1;
                                    string cls = (lst.IndexOf(prod) + 1) % 2 == 0 ? "even" : "odd";


                                    <tr class="@cls">
                                        <td>
                                            @i
                                        </td>


                                        <td>@prod.orderID</td>
                                        <td>@prod.Rdate</td>
                                        <td>@prod.address</td>
                                        <td>@prod.fullname</td>
                                        <td>@prod.phoneRC</td>

                                        @{
                                            switch (prod.status)
                                            {
                                                case "0":
                                                    <td class="order-pending">
                                                        <span>Pending</span>
                                                    </td>
                                                    break;
                                                case "1":
                                                    <td class="order-success">
                                                        <span>Accepted</span>
                                                    </td>
                                                    break;
                                                case "2":
                                                    <td class="order-cancle">
                                                        <span>Rejected</span>
                                                    </td>
                                                    break;
                                                case "3":
                                                    <td class="order-success">
                                                        <span>Preparing</span>
                                                    </td>
                                                    break;
                                                case "4":
                                                    <td class="order-success">
                                                        <span>Sending</span>
                                                    </td>
                                                    break;
                                                case "5":
                                                    <td class="order-success">
                                                        <span>Delivered</span>
                                                    </td>
                                                    break;

                                            }
                                        }






                                        <td>
                                            <ul>
                                                @if (@prod.status == "0")
                                                {
                                                    <li>
                                                        <a href="javascript:void(0)" style="margin:0 6px">
                                                            <i id="@prod.orderID" class="ri-checkbox-circle-line verifyOrder"></i>

                                                        </a>
                                                    </li>
                                                }


                                                <li>
                                                    <a style="margin:0 6px" href="javascript:void(0)" data-bs-toggle="modal" data-bs-target="#exampleModalToggle">


                                                        <i idtoView=@prod.orderID class="ri-eye-fill viewDetail" id=""></i>
                                                    </a>
                                                </li>
                                                <li>
                                                    <i style="margin:0 6px" lat="@prod.latitude" lon="@prod.longitude" id="@prod.orderID" class="ri-user-location-fill showMap"></i>
                                                </li>

                                            </ul>
                                        </td>
                                    </tr>
                                }

                            }

                        </tbody>
                    </table>
                </div>
                <div>
                    <table class="detailTable table all-package theme-table table-product dataTable no-footer" id="table_id" style="margin-top:70px; display:none">
                        <thead>
                            <tr>
                                <th class="sorting_disabled" rowspan="1" colspan="1" style="width: 170px;">Product image</th>
                                <th class="sorting_disabled" rowspan="1" colspan="1" style="width: 170px;">Product title</th>
                                <th class="sorting_disabled" rowspan="1" colspan="1" style="width: 170px;">Product Addson</th>
                                <th class="sorting_disabled" rowspan="1" colspan="1" style="width: 170px;">Product count</th>
                                <th class="sorting_disabled" rowspan="1" colspan="1" style="width: 170px;">actions</th>
                            </tr>
                        </thead>

                        <tbody>
                            @if (Model.partnerOrders != null)
                            {
                                foreach (var prod in Model.partnerOrders)
                                {
                                    string addson = @prod.addson == null ? "" : @prod.addson;

                                    string cls = (Model.partnerOrders.IndexOf(prod) + 1) % 2 == 0 ? "even" : "odd";


                                    <tr class="trbody @cls @prod.orderID">

                                        <td>
                                            <div class="table-image">
                                                <img src="@prod.image" class="img-fluid" alt="">
                                            </div>
                                        </td>

                                        <td>@prod.title</td>
                                        <td>@prod.addson</td>

                                        <td>@prod.quantity</td>



                                        <td>
                                            <ul>



                                                <li>
                                                    <a href="javascript:void(0)" data-bs-toggle="modal" data-bs-target="#exampleModalToggle">


                                                        <i idtoremove=@prod.itemID class="ri-delete-bin-line removeProduct" id=""></i>
                                                    </a>
                                                </li>
                                            </ul>
                                        </td>
                                    </tr>
                                }

                            }

                        </tbody>
                    </table>


                </div>

                
            </div>

        </div>
    </div>
</div>



<script>
    $(".viewDetail").click(function () {
        var id = $(this).attr('idtoView');
        $(".detailTable").show();
        $(".trbody").hide();

        $("." + id).show();

    })
    $(".order").addClass("activve");


    $(".verifyOrder").click(function () {
        var id = $(this).attr('id');
        $.ajax({
            url: '/Partner/changeOrderPartnerStatus',
            dataType: 'html',
            data: {
                id: id

            },
            success: function (data) {
                window.location.reload();
            },
            error: function () {
                alert("error")
            }


        });
    })
</script>

<script>
    $(".showMap").click(function () {
        var lat = $(this).attr('lat');
        var lon = $(this).attr('lon');
        if ($('#mapid').length) {
            $('#mapid').remove();
        }
        var el = "<div> <div id = 'mapid' style = 'margin-top:20px; width:100% ; height:300px'></div></div >"
        $("#prnt").append(el)
       
        showLocation(lat, lon);
        document.getElementById('mapid').scrollIntoView();
    })
</script>