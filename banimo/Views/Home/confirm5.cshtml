@model banimo.ViewModel.confrimVM
@using BotDetect.Web.Mvc;
@using banimo.Classes;
@{
    Layout = null;
}






@{
    /**/

    ViewBag.Title = "";
    Layout = "~/Views/Shared/_Layout5.cshtml";
}


<link href="~/Content/loginStyle4.css" rel="stylesheet" />
<link href="@BotDetect.Web.CaptchaUrls.Absolute.LayoutStyleSheetUrl" rel="stylesheet" type="text/css" />

<link href="~/Content/all.css" rel="stylesheet" />
<script>

    $(document).ready(function () {

        function isValidEmailAddress(emailAddress) {
            var pattern = /^([a-zA-Z0-9_.+-])+\@@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
            return pattern.test(emailAddress);
        };
        function isValidPhonenumber(phonenumber) {
            var pattern = /^09[0-9]{9}$/;
            return pattern.test(phonenumber);
        };
        function isNotNull(str) {
            if (str != "") {
                return true;
            }
            else {
                return false;
            }

        };



    })
</script>
<!-- js -->
<script type="text/javascript" src="/Scripts/jquery-2.1.4.min.js"></script>
<!-- //js -->
<!-- for bootstrap working -->
<script type="text/javascript" src="/Scripts/bootstrap-3.1.1.min.js"></script>
<!-- //for bootstrap working -->
<script>
    $(document).ready(function () {
        function isValidPhonenumber(phonenumber) {
            var pattern = /^09[0-9]{9}$/;
            return pattern.test(phonenumber);
        };
        function isNotNull(str) {
            var pattern = /^[A-Za-z0-9]{1,20}$/;
            return pattern.test(str);
        };
        $('#registertext').on('input', function (e) {

            var val = $(this).val();
            if (val.length > 0) {

                if (!isValidPhonenumber(val)) {

                    $("#registererror").css("display", "block");
                    $("#registertext").css("color", "#ef5662");
                    $("#registertext").css("border", "1px solid #ef5662");
                    $("#mainlabla").addClass("error");


                }
                else {
                    $("#registererror").css("display", "none");
                    $("#registertext").css("color", "#777");
                    $("#registertext").css("border", "1px solid #c8c8c8");
                    $("#mainlabla").removeClass("error");
                }

            }
            else {

                $("#registererror").css("display", "none");
                $("#registertext").css("color", "#777");
                $("#registertext").css("border", "1px solid #c8c8c8");
                $("#mainlabla").removeClass("error");
            }

        });
        $('#registerpassword').on('input', function (e) {

            var val = $(this).val();

            if ($(this).val().length === 0) {
                $("#registerpassword-error").css("display", "block");
                $("#registertext").css("color", "#ef5662");
                $("#registerpassword").css("border", "1px solid #ef5662");
                $("#mainlabla2").addClass("error");
            }
            else {
                $("#registerpassword-error").css("display", "none");
                $("#registertext").css("color", "#777");
                $("#registerpassword").css("border", "1px solid #c8c8c8");
                $("#mainlabla2").removeClass("error");
            }

        });

    })
</script>
<script>
    $("#verify").click(function () {

        alert("ssss");

        //
    })

</script>
<script src="~/Scripts/toastr.js"></script>
<script type="text/javascript">
    function preventBack() { window.history.forward(); }
    setTimeout("preventBack()", 0);
    window.onunload = function () { null };
</script>
@Scripts.Render("~/Scripts/captcha.validate.js")

<link href="~/Content/toastr.css" rel="stylesheet" />

<script>
    function addMinutes(date, minutes) {
        return new Date(date.getTime() + minutes * 60000);
    }
    var deadline = addMinutes(new Date(), 1);
    var x = setInterval(function () {
        var now = new Date().getTime();
        //  var deadline = addMinutes(now, 2);
        var t = deadline - now;
        var days = Math.floor(t / (1000 * 60 * 60 * 24));
        var hours = Math.floor((t % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        var minutes = Math.floor((t % (1000 * 60 * 60)) / (1000 * 60));
        var seconds = Math.floor((t % (1000 * 60)) / 1000);
        document.getElementById("demo").innerHTML = seconds + "s ";
        if (t < 0) {
            clearInterval(x);
            $("#counterholder").css("visibility", "hidden");
            $("#resendButt").css("visibility", "inherit");
        }
    }, 1000);
</script>

@if (ViewBag.error == "300")
{
    <script>
        toastr.options = {
            "debug": false,
            "positionClass": "toast-top-center",
            "onclick": null,
            "fadeIn": 300,
            "fadeOut": 1000,
            "timeOut": 8000,
            "extendedTimeOut": 1000,
        }
        toastr.error('کد تایید صحیح نیست!')
    </script>
}
else if (ViewBag.error == "400")
{
    <script>
        toastr.options = {
            "debug": false,
            "positionClass": "toast-top-center",
            "onclick": null,
            "fadeIn": 300,
            "fadeOut": 1000,
            "timeOut": 8000,
            "extendedTimeOut": 1000,
        }
        toastr.error('برای تلاش مجدد 20 ثانیه زمان لازم است')
    </script>
}
<div  style="margin-top:50px">

    <main id="main" style="margin-top:50px">
        <div class="semi-modal-layout">
            <section class="o-page o-page--account-box">
                <div class="c-account-box ">

                    <div class="c-account-box__headline">تایید شماره تلفن همراه</div>
                    <div class="c-account-box__content">
                        <form action="/CustomerLogin/checkConfirmCode" class="c-form-account" method="post" id="confirmForm">
                            @Html.AntiForgeryToken();
                            <input name="phone" hidden value="@Model.id" />
                            <div class="c-message-light c-message-light--success">
                                <span>برای شماره همراه @Model.id  کد تایید ارسال گردید</span>
                                <a href="/Home/Register" class="btn-link-spoiler">ویرایش شماره</a>
                            </div>
                            <div class="c-form-account__title">کد تایید را وارد نمایید.</div>
                            <div class="c-form-account__row">
                                <div class="c-form-account__col">
                                    <label class="c-ui-input c-ui-input--account-sms">
                                        <input style="text-align:center; font-size:18px;" name="register" id="verificationcode" class="c-ui-input__field" type="text" placeholder="" maxlength="5" name="confirm[code]">
                                    </label>
                                    <div class="c-ui-feedback-hint c-message c-message-light c-message-light--error">نام کاربری را به شکل صحیح وارد کنید</div>
                                </div>
                            </div>
                            <div class="c-form-account__link">
                                <div id="counterholder" class="js-phone-code-container u-hidden">
                                    <span>دریافت مجدد کد تایید</span>
                                    (<span id="demo" class="js-phone-code-counter" data-countdownseconds="180">۰۰:۰۰</span>)
                                </div>
                                <a style="visibility:hidden;margin-bottom:20px" id="resendButt" class="btn-link-spoiler js-send-confirm-code">دریافت مجدد کد تایید</a>
                                <script>
                                          $("#resendButt").click(function () {
                                              $("#resendButt").css("visibility", "hidden");
                                              $("#counterholder").css("visibility", "inherit");

                                              function addMinutes(date, minutes) {
                                                  return new Date(date.getTime() + minutes * 60000);
                                              }
                                              var deadline = addMinutes(new Date(), 1);
                                              var x = setInterval(function () {
                                                  var now = new Date().getTime();
                                                  //  var deadline = addMinutes(now, 2);
                                                  var t = deadline - now;
                                                  var days = Math.floor(t / (1000 * 60 * 60 * 24));
                                                  var hours = Math.floor((t % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                  var minutes = Math.floor((t % (1000 * 60 * 60)) / (1000 * 60));
                                                  var seconds = Math.floor((t % (1000 * 60)) / 1000);
                                                  document.getElementById("demo").innerHTML =  seconds + "s ";

                                                  if (t <0) {
                                                      clearInterval(x);
                                                      $("#counterholder").css("visibility", "hidden");
                                                      $("#resendButt").css("visibility", "inherit");
                                                  }
                                              }, 1000);
                                              $.ajax({
                                                  url: '/CustomerLogin/ResendCode',
                                                  dataType: 'html',
                                                  data: {
                                                      phone: "@Model.id",
                                                  },
                                                  success: function (data) {




                                                      if (data === "300") {
                                                          toastr.options = {
                                                              "debug": false,
                                                              "positionClass": "toast-top-center",
                                                              "onclick": null,
                                                              "fadeIn": 300,
                                                              "fadeOut": 1000,
                                                              "timeOut": 8000,
                                                              "extendedTimeOut": 1000,


                                                          }
                                                          toastr.error('خطا مجددا تلاش کنید!')
                                                          $("#verificationcode").val("");

                                                          // $('#lblsubscribeSubmit').text("");
                                                      }
                                                      if (data === "200") {

                                                          toastr.options = {
                                                              "debug": false,
                                                              "positionClass": "toast-top-center",
                                                              "onclick": null,
                                                              "fadeIn": 300,
                                                              "fadeOut": 1000,
                                                              "timeOut": 8000,
                                                              "extendedTimeOut": 1000,


                                                          }
                                                          toastr.success('ارسال مجدد پیام با موفقیت انجام شد')
                                                          //window.location.href = URL;
                                                      }




                                                  },
                                                  error: function () {
                                                      $('#lblsubscribeSubmit').text("خطای سیستمی، لطفاً با اپراتور تماس بگیرید");
                                                  }
                                              });
                                          })
                                </script>
                            </div>
                            <p id="demo"></p>

                            <div id="verify" class="mybtn addtocart" style="">

                                <p class=" buttonverif">تایید کد</p>
                                <script>
                                        $("#verify").click(function () {
                                            $("#confirmForm").submit();
                                            @*$('#lblsubscribeSubmit').text("");


                                            var verificationcode = $("#verificationcode").val();
                                            if ("@Model.pass" === "") {
                                                $.ajax({
                                                    url: '/CustomerLogin/checkConfirmCode',
                                                    dataType: 'html',
                                                    data: {

                                                        phone: "@Model.id",
                                                        register: verificationcode
                                                    },
                                                    success: function (data) {


                                                        if (data === "300") {
                                                            toastr.options = {
                                                                "debug": false,
                                                                "positionClass": "toast-top-center",
                                                                "onclick": null,
                                                                "fadeIn": 300,
                                                                "fadeOut": 1000,
                                                                "timeOut": 8000,
                                                                "extendedTimeOut": 1000,


                                                            }
                                                            toastr.error('کد تایید صحیح نیست!')
                                                            $("#verificationcode").val("");

                                                            // $('#lblsubscribeSubmit').text("");
                                                        }
                                                        if (data === "200") {

                                                            if ('@ViewBag.changPass' != "") {
                                                                var url = '@Url.Action("ChangePass", "Home")';
                                                            }
                                                            else {
                                                                 var url = '@Url.Action(@ViewBag.last, "Home")';
                                                            }


                                                            window.location.href = url;
                                                        }




                                                    },
                                                    error: function () {
                                                        $('#lblsubscribeSubmit').text("خطای سیستمی، لطفاً با اپراتور تماس بگیرید");
                                                    }
                                                });
                                            }
                                            else {
                                                $.ajax({
                                                    url: '/CustomerLogin/CustomerRegister',
                                                    dataType: 'html',
                                                    data: {

                                                        pass: "@Model.pass",
                                                        phone: "@Model.id",
                                                        val: verificationcode
                                                    },
                                                    success: function (data) {

                                                        var srt = data.substring(0, data.indexOf("*"));;
                                                        var URL = data.substring(data.indexOf("*") + 1)


                                                        if (srt === "300") {
                                                            toastr.options = {
                                                                "debug": false,
                                                                "positionClass": "toast-top-center",
                                                                "onclick": null,
                                                                "fadeIn": 300,
                                                                "fadeOut": 1000,
                                                                "timeOut": 8000,
                                                                "extendedTimeOut": 1000,


                                                            }
                                                            toastr.error('کد تایید صحیح نیست!')
                                                            $("#verificationcode").val("");

                                                            // $('#lblsubscribeSubmit').text("");
                                                        }
                                                        if (srt === "200") {

                                                            toastr.options = {
                                                                "debug": false,
                                                                "positionClass": "toast-top-center",
                                                                "onclick": null,
                                                                "fadeIn": 300,
                                                                "fadeOut": 1000,
                                                                "timeOut": 8000,
                                                                "extendedTimeOut": 1000,


                                                            }
                                                            toastr.success('با موفقیت وارد شدید')

                                                            window.location.href = URL;
                                                        }




                                                    },
                                                    error: function () {
                                                        $('#lblsubscribeSubmit').text("خطای سیستمی، لطفاً با اپراتور تماس بگیرید");
                                                    }
                                                });
                                            }*@

                                        })


                                </script>
                                @*<p > افزودن به سبد خرید</p>*@
                            </div>

                        </form>
                    </div>
                    <div class="c-account-box__footer">
                        <span>قبلا در @System.Configuration.ConfigurationManager.AppSettings["siteName"] ثبت‌نام کرده‌اید؟</span>
                        <a href="/home/login" class="btn-link-spoiler">وارد شویــد</a>
                    </div>
                </div>
            </section>

        </div>
    </main>
</div>
