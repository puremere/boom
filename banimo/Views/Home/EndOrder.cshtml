
@using banimo.ViewModel;
@model banimo.ViewModel.TimeList
@{
    /**/

    ViewBag.Title = "نهایی سازی سفارش";
    Layout = "~/Views/Shared/_Layout.cshtml";
}



@section scripts{

    <link href="~/Content/endOrderStyle.css" rel="stylesheet" />



    <script>

        function addCommas(nStr) {
            nStr += '';
            var x = nStr.split('.');
            var x1 = x[0];
            var x2 = x.length > 1 ? '.' + x[1] : '';
            var rgx = /(\d+)(\d{3})/;
            while (rgx.test(x1)) {
                x1 = x1.replace(rgx, '$1' + ',' + '$2');
            }
            return x1 + x2;
        }
    </script>
    <script>
        $(document).ready(function () {
            $(".master").click(function () {

                $(".dispath").css("display", "none");
                var i = $(this).children();
                i.css("display", "block");

                var id = i.attr("id");

                $(".slave").css("display", "none");
                $("#" + id).css("display", "block");
                $("#" + id).children().children().first().css("display", "block");
                $("#hourid").val($("#" + id).children().children().first().attr("id"));


            })
            $(".slave .halfrow").click(function () {
                $(".finalrow").css("display", "none");
                var i = $(this).children();
                i.css("display", "block");
                var id = i.attr("id");
                $("#hourid").val(id);
            })
        })
    </script>
    <script>
        $("#mellat").click(function () {
            $(".banky").css("display", "none");
            $(this).children().children("i").css("display", "inline-block");
            $("#payment").val("3");
        })
        $("#pasargad").click(function () {
            $(".banky").css("display", "none");
            $(this).children().children("i").css("display", "inline-block");
            $("#payment").val("4");
        })

        $("#internet").click(function () {
            $(".banky").css("display", "none");
            $(this).children().children("i").css("display", "inline-block");
            $("#payment").val("5");
        })
        $("#inplace").click(function () {
            $(".banky").css("display", "none");
            $(this).children().children("i").css("display", "inline-block");
            $("#payment").val("2");
        })

        $("#Wallet").click(function () {
            $(".banky").css("display", "none");
            $(this).children().children("i").css("display", "inline-block");
            $("#payment").val("1");
        })
    </script>

    <script>

        $(".panel").css("display", "block");
        var acc = document.getElementsByClassName("accordion");
        var i;

        for (i = 0; i < acc.length; i++) {
            acc[i].addEventListener("click", function () {
                this.classList.toggle("active");
                var panel = this.nextElementSibling;
                if (panel.style.display === "block") {
                    panel.style.display = "none";
                } else {
                    panel.style.display = "block";
                }
            });
        }
    </script>
    <script>
        let value = "0";
        $("#lableToggle input").click(function () {


            if ($(this).is(':checked')) {
                $("#raveshpardakht").css("display", "none");

                value = "1"
            }
            else {
                $("#raveshpardakht").css("display", "block");
                value = "1"
            }
        })
        $(".field").on('input', function () {

            var thisval = $(this).val();

            if (thisval.length > 1) {
                $(this).css("border-color", "#b5afaf");

            }
            else {
                $(this).css("border-color", "red");
            }

        })
        $("#finalconfirm").click(function () {



            var addressID = $("#addressID").val();
            var counter = 0;
            var payment = $("#payment").val();


            if (addressID == "") {
                toastr.options = {
                    "debug": false,
                    "positionClass": "toast-top-center",
                    "onclick": null,
                    "fadeIn": 300,
                    "fadeOut": 1000,
                    "timeOut": 3000,
                    "extendedTimeOut": 1000
                }
                toastr.error("لطفا آدرس خود را انتخاب کنید");
                counter = 1;
            }

            if (payment == "" && value == "0") {
                toastr.options = {
                    "debug": false,
                    "positionClass": "toast-top-center",
                    "onclick": null,
                    "fadeIn": 300,
                    "fadeOut": 1000,
                    "timeOut": 3000,
                    "extendedTimeOut": 1000
                }
                toastr.error("لطفا روش پرداخت را انتخاب کنید");
                counter = 1;
            }
            if (counter == 0) {
                $("form#endOrderForm").submit();
            }


        })
    </script>

  
        @*<script type="text/javascript" src="https://cdn.map.ir/web-sdk/1.4.2/js/jquery-3.2.1.min.js"></script>
        <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false&libraries=places&key=AIzaSyDnIMRNDW6W-9c74yyiO_Sp3oeya0hoLwQ"></script>*@

            <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
                    integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
                    crossorigin="">
            </script>

            <script type="text/javascript">
                var myMap;
                var theMarker = {};
                var greenIcon;
            getLocation();
            function showLocation(position) {
                var lat = position.coords.latitude;
                var lon = position.coords.longitude;



                myMap = L.map('Map', { attributionControl: false }).setView([35.75453394917301, 51.37116999302821], 13);

                L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
                    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
                    maxZoom: 18,
                    id: 'mapbox/streets-v11',
                    tileSize: 512,
                    zoomOffset: -1,
                    accessToken: 'pk.eyJ1IjoibWVyaW9saSIsImEiOiJja2p6dXhmdngwYmVvMnZwY2lyc2htNGxhIn0.Y9t__Bll6Fw9b9amb_rcHg',

                }).addTo(myMap);
                myMap.panTo(new L.LatLng(lat, lon));

                var greenIcon = new L.Icon({
                    iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
                    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                    iconSize: [25, 41],
                    iconAnchor: [12, 41],
                    popupAnchor: [1, -34],
                    shadowSize: [41, 41]
                });






               
                myMap.on('click', function (e) {

                    lat = e.latlng.lat;
                    lon = e.latlng.lng;

                    console.log("You clicked the map at LAT: " + lat + " and LONG: " + lon);
                    //Clear existing marker,

                    if (theMarker != undefined) {
                        myMap.removeLayer(theMarker);
                    };

                    //Add a marker to show where you clicked.
                    theMarker = L.marker([lat, lon], { icon: greenIcon }).addTo(myMap);
                    $("#lat").val(lat);
                    $("#lon").val(lon);
                });
                theMarker = L.marker([lat, lon], { icon: greenIcon }).addTo(myMap);
                $("#lat").val(lat);
                $("#lon").val(lon);






            }
            function errorHandler(err) {
                if (err.code == 1) {
                    //alert("Error: Access is denied!");
                } else if (err.code == 2) {
                    //alert("Error: Position is unavailable!");
                }

               
                myMap = L.map('Map', { attributionControl: false }).setView([35.75453394917301, 51.37116999302821], 13);
                L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
                    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
                    maxZoom: 18,
                    id: 'mapbox/streets-v11',
                    tileSize: 512,
                    zoomOffset: -1,
                    accessToken: 'pk.eyJ1IjoibWVyaW9saSIsImEiOiJja2p6dXhmdngwYmVvMnZwY2lyc2htNGxhIn0.Y9t__Bll6Fw9b9amb_rcHg',

                }).addTo(myMap);

                myMap.panTo(new L.LatLng(35.73598454240641, 51.48437862217327));


                greenIcon = new L.Icon({
                    iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
                    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                    iconSize: [25, 41],
                    iconAnchor: [12, 41],
                    popupAnchor: [1, -34],
                    shadowSize: [41, 41]
                });




               
                myMap.on('click', function (e) {

                    lat = e.latlng.lat;
                    lon = e.latlng.lng;

                    console.log("You clicked the map at LAT: " + lat + " and LONG: " + lon);
                    //Clear existing marker,

                    if (theMarker != undefined) {
                        myMap.removeLayer(theMarker);
                    };

                    //Add a marker to show where you clicked.
                    theMarker = L.marker([lat, lon], { icon: greenIcon }).addTo(myMap);

                    $("#lat").val(lat);
                    $("#lon").val(lon);
                });


            }
            function getLocation() {
                if (navigator.geolocation) {
                    // timeout at 60000 milliseconds (60 seconds)
                    var options = { timeout: 60000 };
                    navigator.geolocation.getCurrentPosition
                        (showLocation, errorHandler, options);
                } else {
                    alert("Sorry, browser does not support geolocation!");
                }
            }


            $("#mapshow p").click(function () {
                $("#mapshow").hide();
                $("#mapHolder").css("position", "fixed");
                $("#mapHolder").css("width", "100%");
                $("#mapHolder").css("height", "100%");
                $("#maphide").css("display", "block")

            })
            $("#maphide span").click(function () {
                $("#mapHolder").css("position", "relative");
                $("#mapHolder").css("width", "100%");
                $("#mapHolder").css("height", "250px");
                $("#mapshow").css("display", "block");
                $("#mapshow").show();
                var lat = $("#lat").val();
                var lon = $("#lon").val();
                myMap.panTo(new L.LatLng(lat, lon));
                $("#maphide").hide();
                if ('@Model.poly' !== '') {

                    $("#loading").fadeIn();

                    $.ajax({
                        url: "/Home/inInArea",
                        data: 'html',
                        data: {
                            lat: $("#lat").val(),
                            log: $("#lon").val(),
                        },
                        success: function (data) {

                            var deliver = parseInt($("#deliveryprice").text().replace(",", ""));
                            let price = parseInt($("#totalprice").text().replace(",", ""));
                            if (data == "1") {

                                let final = price - deliver;
                                $("#deliveryprice").text("0");
                                $("#totalprice").text(addCommas(final));

                                toastr.options = {
                                    "debug": false,
                                    "positionClass": "toast-top-center",
                                    "onclick": null,
                                    "fadeIn": 300,
                                    "fadeOut": 1000,
                                    "timeOut": 5000,
                                    "extendedTimeOut": 1000
                                }
                                toastr.success("برای موقعیت شما ارسال رایگان است");
                                $("#loading").fadeOut();
                            }
                            else {

                                if (deliver == 0 && price < parseInt('@Model.baseDeliver')) {
                                    $("#deliveryprice").text('@Model.priceDeliver');
                                    $("#totalprice").text(addCommas(price + parseInt('@Model.priceDeliver')));

                                    toastr.options = {
                                        "debug": false,
                                        "positionClass": "toast-top-center",
                                        "onclick": null,
                                        "fadeIn": 300,
                                        "fadeOut": 1000,
                                        "timeOut": 5000,
                                        "extendedTimeOut": 1000
                                    }
                                    toastr.error("برای موقعیت شما ارسال رایگان نمی باشد");
                                }
                                $("#loading").fadeOut();
                            }


                        }
                    });

                }


            });

            $("#verifyAddress").click(function () {
                var lat = $("#lat").val();
                var lng = $("#lon").val();
                var address = $("#modalAddress").val();
                var postalCode = $("#modalpostalCode").val();
                var title = $("#modalTitle").val();
                var city = $("#modalCity").val();
                var ID = $("#modalID").val();
                var value = "0";
                if (lat == "" || lng == "") {
                    toastr.options = {
                        "debug": false,
                        "positionClass": "toast-top-center",
                        "onclick": null,
                        "fadeIn": 300,
                        "fadeOut": 1000,
                        "timeOut": 5000,
                        "extendedTimeOut": 1000
                    }
                    toastr.error("موقعیت خود را انتخاب کنید");
                    value = "1";
                };
                if (address == "" || postalCode == "" || title == "") {
                    toastr.options = {
                        "debug": false,
                        "positionClass": "toast-top-center",
                        "onclick": null,
                        "fadeIn": 300,
                        "fadeOut": 1000,
                        "timeOut": 5000,
                        "extendedTimeOut": 1000
                    }
                    toastr.error("لطفا همه موارد را کامل کنید");
                    value = "1";
                }
               
                if (value == "0") {
                    $.ajax({
                        url: "setAddress",
                        dataType: "html",
                        data: {
                            lat: lat,
                            lng: lng,
                            address: address,
                            postalCode: postalCode,
                            title: title,
                            city: city,
                            id : ID
                        },
                        success: function (data) {
                            window.location.reload();
                        }
                    });
                }


            });

                $(".addressy").click(function () {

                    var id = $(this).attr('id');
                    $("#addressID").val(id);



                    $(".addressy").find('i').css("display", "none")
                    $(this).find('i').css("display", "block");

                });
                $(".removeAddress").click(function (e) {
                    e.stopPropagation();
                    var sid = $(this).parent().parent().attr('id');
                    $.ajax({
                        url: "removeAddress",
                        dataType: "html",
                        data: {
                            id: sid
                        },
                        success: function (data) {
                            window.location.reload();
                        }
                    });
                });
                $(".editAddress").click(function (e) {
                    e.stopPropagation();
                    var sid = $(this).parent().parent().attr('id');
                    var addes = @Html.Raw(Json.Encode(Model.address))
                        $.each(addes, function (index, item) {
                           
                            var id = item.ID;
                            if (sid == id) {
                                $("#addressModal").modal('toggle');
                                $("#modalTitle").val(item.title);
                                $("#modalCity").val(item.city);
                                $("#modalAddress").val(item.address);
                                $("#modalpostalCode").val(item.postalCode);
                                $("#modalID").val(item.ID);

                                var lat = item.lat;
                                var lon = item.lng;
                              
                                $("#lat").val(lat);
                                $("#lon").val(lon);
                                if (theMarker != undefined) {
                                    myMap.removeLayer(theMarker);
                                };

                                //Add a marker to show where you clicked.
                                theMarker = L.marker([lat, lon], { icon: greenIcon }).addTo(myMap);
                                myMap.panTo(new L.LatLng(lat, lon));
                            }
                           

                        });

                })

            </script>



}

<div class="modal fade" id="addressModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document" style="width:80%; height:90%">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div style="margin:0px">
                    <p style="text-align:right; margin:20px 5px;font-size:16px; font-weight:600; ">: عنوان </p>
                    <input id="modalTitle" style="text-align:right; margin:20px 0" class="form-control" />
                </div>
                <div style="margin:0px">
                    <p style="text-align:right; margin:20px 5px;font-size:16px; font-weight:600; ">: شهر </p>
                    <input id="modalCity" style="text-align:right; margin:20px 0" class="form-control" />
                </div>
                <div style="margin:0px">
                    <p style="text-align:right; margin:20px 5px;font-size:16px; font-weight:600; ">: آدرس </p>
                    <input id="modalAddress" style="text-align:right; margin:20px 0" class="form-control" />
                </div>
                <div style="margin:0px">
                    <p style="text-align:right; margin:20px 5px;font-size:16px; font-weight:600; ">: کد پستی </p>
                    <input id="modalpostalCode" style="text-align:right; margin:20px 0" class="form-control" />
                </div>

                <div id="mapHolder" style="z-index:999; position:relative;top:0; left:0; margin:auto; width:100%; height:250px;  background-color:white; display:block; text-align:center; background-color:white;  /* Negative half of width. */">
                    <div id="mapshow" style="position:absolute; width:100%; height:90%; z-index:999999">
                        <p style="cursor:pointer;   z-index: 9999999; width: 100%;bottom: 0;position: absolute;"><span style=" color: white; background-color: #4f9d94; border-radius: 5px; padding: 20px 30px;">انتخاب موقعیت</span></p>
                    </div>
                    <div id="Map" style="margin-top:5%; width: 100%; margin:auto; height: 90%; background: #eee; border: 2px solid #aaa;"></div>
                    <p id="maphide" style="display:none; cursor:pointer;   z-index: 9999999; width: 100%;bottom: 15px;position: absolute;"><span style=" color: white; background-color: #4f9d94; border-radius: 5px; padding: 20px 30px;">انتخاب موقعیت</span></p>
                </div>
                <p style="display:none" id="modalID"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">لغو</button>
                <button id="verifyAddress" type="button" class="btn btn-primary ">تایید</button>
            </div>
        </div>
    </div>
</div>


@{



    userdata user = @Session["LogedInUser"] as userdata;
    string fullname = user.fullname;
    string phone = user.phone;
    string address = user.address;
    string city = user.city;
    string ostan = user.province;


    <form id="endOrderForm" name="endOrderForm" action="EndOrder" method="post">
        <p id="error" style="color :red; text-align:center; padding:10px"></p>
        <input hidden name="lat" id="lat" value="0" />
        <input hidden name="lon" id="lon" value="0" />
        <input hidden name="addID" id="addID" value="0" />
        <input hidden name="disc" id="lon" value="0" />

        <div id="app" style="width:100%; height:100%"></div>

        <div style="margin:30px 0px 30px 0px"></div>
        <div class="main_container" style="width: 50%; margin: auto">

            <div class="containerofform">
                <div class="header"><p>انتخاب آدرس</p></div>
                <div class="sectionBody" style="text-align:center">

                    @{
                        if (Model.address != null)
                        {
                            foreach (var item in Model.address)
                            {
                                <div id="@item.ID" style="margin:20px; padding:20px; " class="halfrow addressy">
                                    <i class="fa fa-check " style="display:none; margin:0 5px"></i>

                                    <div style="text-align:right;font-size:14px; font-weight:600">   @item.title</div><br />
                                    <div style="text-align:right; font-size:14px"> آدرس :   @item.address</div>
                                    <div class="row" ; style="margin-top:30px; margin-bottom:10px">
                                        <p class="btn btn-default editAddress" style="display:block; margin:-10px 10px" >ویرایش</p>
                                        <p class="btn btn-danger removeAddress" style="display:block; margin: -10px 10px">حذف</p>
                                    </div>

                                </div>
                            }
                        }
                    }

                    <p class="btn btn-success" data-toggle="modal" data-target="#addressModal">افزودن آدرس جدید</p>

                    @*<div class="row ">
                            <div class="col-lg-12 col-sm-12 row1 ">
                                <div class="inputdiv1"><p>شهر</p></div>
                                <div class="inputdiv2"><input id="city" name="city" class="form-control field" type="text" value="@city" /></div>
                            </div>


                        </div>
                        <div class="row ">
                            <div class="col-lg-6 col-sm-6 row1 ">
                                <div class="inputdiv1"><p>نام و نام خانوادگی</p></div>
                                <div class="inputdiv2"><input id="fullname" name="fullname" class="form-control field" type="text" value="@fullname" /></div>
                            </div>
                            <div class="col-lg-6 col-sm-6 row1">
                                <div class="inputdiv1"><p>آدرس</p></div>
                                <div class="inputdiv2"><input id="address" name="address" class="form-control field" type="text" value="@address" /></div>
                            </div>

                        </div>
                        <div class="row ">
                            <div class="col-lg-6 col-sm-6 row1">
                                <div class="inputdiv1"><p>شماره تلفن</p></div>
                                <div class="inputdiv2"><input id="phonenumber" name="phonenumber" class="form-control field" type="text" value="@phone" /></div>
                            </div>
                            <div class="col-lg-6 col-sm-6 row1 ">
                                <div class="inputdiv1"><p>کد پستی</p></div>
                                <div class="inputdiv2"><input id="postalcode" name="postalcode" class="form-control" type="text" /></div>
                            </div>


                        </div>*@
                </div>

            </div>



            <div class="containerofform">
                <div class="header"><p> زمان ارسال</p></div>
                <div class="sectionBody">
                    <div class="row ">
                        @{
                            if (Model.times != null)
                            {

                                foreach (var item in Model.times)
                                {

                                    int index = Model.times.IndexOf(item);
                                    string checkname = "check" + index;
                                    if (index == 0)
                                    {
                                        <div class="col-lg-6 col-sm-6 slave" id="@checkname">
                                            @foreach (var detail in item.hours)
                                            {

                                                string finalname = "final" + detail.ID;

                                                <div class="halfrow">
                                                    @if (@detail.isChecked == true)
                                                    {
                                                        <i class="fa fa-check finalrow" id="@finalname"></i>
                                                    }
                                                    else
                                                    {
                                                        <i class="fa fa-check finalrow" id="@finalname" style="display:none"></i>
                                                    }

                                                    <p>@detail.title</p>
                                                </div>
                                            }
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="col-lg-6 col-sm-6 slave" id="@checkname" style="display:none">
                                            @foreach (var detail in item.hours)
                                            {

                                                string finalname = "final" + detail.ID;

                                                <div class="halfrow ">
                                                    @if (@detail.isChecked == true)
                                                    {
                                                        <i class="fa fa-check finalrow" id="@finalname"></i>
                                                    }
                                                    else
                                                    {
                                                        <i class="fa fa-check finalrow" id="@finalname" style="display:none"></i>
                                                    }

                                                    <p>@detail.title</p>
                                                </div>
                                            }
                                        </div>
                                    }

                                }

                                <div class="col-lg-6 col-sm-6 Mmaster">
                                    @foreach (var item in Model.times)
                                    {
                                        int index = Model.times.IndexOf(item);
                                        string checkname = "check" + index;
                                        <div class="halfrow master">
                                            @if (@item.isChecked == true)
                                            {
                                                <i class="fa fa-check dispath" id="@checkname"></i>
                                            }
                                            else
                                            {
                                                <i class="fa fa-check dispath" id="@checkname" style="display:none"></i>
                                            }

                                            <p>@item.title</p>
                                        </div>
                                    }
                                </div>

                            }
                        }


                    </div>
                </div>
            </div>

          
            <div class="containerofform">
                <div class="header"><p> کد تخفیف</p></div>
                <div class="sectionBody">
                    <div class="row ">
                        <div style="padding:7px 15px; width:70%; margin-right : auto; margin-left: auto; border-bottom:2px solid green">
                            <div class="row">
                                <i class="fa fa-pen" style="float:right; width:10%"></i>
                                <input id="discountfake" style="border:none; float:left; width:90%" />
                                <input id="discount" style="display:none; border:none; float:left; width:90%" />


                            </div>

                        </div>
                        <div class="row" style="width:80%; margin:auto;  color:#2585bd">
                            <div style="float:left" id="discountConfirm" class="btn-link-spoiler btn-link-spoiler--edit">
                                ثبت کد تخفیف
                            </div>
                            <script>

                                $('#discountConfirm').click(function () {
                                   
                                    var mot = $("#finalprice").text().replace(",", '')
                                    mot = mot.replace(',', "");
                                    var discount = $('#discountfake').val();


                                    //alert(discount);
                                    if (discount == "") {


                                        toastr.options = {
                                            "debug": false,
                                            "positionClass": "toast-top-center",
                                            "onclick": null,
                                            "fadeIn": 300,
                                            "fadeOut": 1000,
                                            "timeOut": 5000,
                                            "extendedTimeOut": 1000
                                        }
                                        toastr.error("نام تخفیف را وارد نمایید");
                                    }
                                    else {
                                        $.ajax({
                                            url: '/Home/SetDiscount',
                                            dataType: 'html',
                                            data: {
                                                val: discount,
                                                price: mot
                                            },
                                            success: function (data) {
                                              
                                                let obj = jQuery.parseJSON(data);

                                                if (obj.message.length > 0) {
                                                   
                                                    toastr.options = {
                                                        "debug": false,
                                                        "positionClass": "toast-top-center",
                                                        "onclick": null,
                                                        "fadeIn": 300,
                                                        "fadeOut": 1000,
                                                        "timeOut": 5000,
                                                        "extendedTimeOut": 1000
                                                    }
                                                    toastr.error(obj.message);

                                                    // let price = parseInt($("#finalprice").val())

                                                }
                                                else {
                                                    $("#discount").val(discount);
                                                    var mot = $("#finalprice").text().replace(",", '')
                                                    mot = mot.replace(',', "");
                                                    var del = $("#deliveryprice").text().replace(",", '')
                                                    del = del.replace(',', "");
                                                    if (parseInt(mot) - parseInt(obj.price) > 0) {
                                                        toastr.options = {
                                                            "debug": false,
                                                            "positionClass": "toast-top-center",
                                                            "onclick": null,
                                                            "fadeIn": 300,
                                                            "fadeOut": 1000,
                                                            "timeOut": 5000,
                                                            "extendedTimeOut": 1000
                                                        }
                                                        toastr.success("کد تخفیف اعمال شد");
                                                        if (parseInt(obj.price) > parseInt(mot)) {
                                                            $("#totalprice").text("0");
                                                        }
                                                        else {

                                                            $("#totalprice").text(addCommas(parseInt(mot) - parseInt(obj.price) + parseInt(del)))

                                                        }

                                                        $("#finalDiscount").text(obj.price);
                                                    }
                                                }
                                            },
                                            error: function () {

                                            }

                                        })
                                    }

                                })
                            </script>
                        </div>


                    </div>
                </div>
            </div>

            <div class="containerofform">
                <div class="header"><p> مبلغ نهایی</p></div>
                <div class="sectionBody">
                    <div class="row ">

                        <div id="finalPriceHolder" style="">
                            <div class="row priceitem">
                                @{
                                    decimal totalprice = decimal.Parse(Model.finalAmount) + decimal.Parse(Model.priceDeliver);
                                }

                                <p class="col-lg-6 col-sm-6 Holder"> <i id="finalprice">@String.Format("{0:n0}", @Model.finalAmount)</i>&nbsp;تومان</p>
                                <p class="col-lg-6 col-sm-6">مبلغ</p>

                            </div>
                            <div class="row priceitem">
                                <p class="col-lg-6 col-sm-6 Holder"> <i id="finalDiscount">0</i>&nbsp;تومان</p>
                                <p class="col-lg-6 col-sm-6">تخفیف</p>

                            </div>
                            <div class="row priceitem">
                                <p class="col-lg-6 col-sm-6 deliveryHolder Holder"><span id="deliveryprice">@String.Format("{0:n0}", @Model.priceDeliver)</span>&nbsp;تومان</p>
                                <p class="col-lg-6 col-sm-6">هزینه ارسال</p>

                            </div>
                            <div class="row priceitem">
                                <p class="col-lg-6 col-sm-6 Holder"><span id="totalprice"> @String.Format("{0:n0}", totalprice)  </span>&nbsp;تومان</p>
                                <p class="col-lg-6 col-sm-6">مبلغ نهایی</p>

                            </div>

                        </div>


                    </div>
                </div>
            </div>


            <div class="containerofform">
                <div class="header"><p> استفاده از اعتبار</p></div>
                <div class="sectionBody">
                    <div class="row ">

                        <div id="finalPriceHolder" style="">
                            <div class="row priceitem">
                                <p class="col-lg-6 col-sm-6 Holder"> <i id="finalprice">@Model.credit</i>&nbsp;تومان</p>
                                <p class="col-lg-6 col-sm-6">اعتبار</p>

                            </div>
                            <style>
                                .switch {
                                    position: relative;
                                    display: inline-block;
                                    width: 60px;
                                    height: 34px;
                                }

                                    .switch input {
                                        opacity: 0;
                                        width: 0;
                                        height: 0;
                                    }

                                .slider {
                                    position: absolute;
                                    cursor: pointer;
                                    top: 0;
                                    left: 0;
                                    right: 0;
                                    bottom: 0;
                                    background-color: #ccc;
                                    -webkit-transition: .4s;
                                    transition: .4s;
                                }

                                    .slider:before {
                                        position: absolute;
                                        content: "";
                                        height: 26px;
                                        width: 26px;
                                        left: 4px;
                                        bottom: 4px;
                                        background-color: white;
                                        -webkit-transition: .4s;
                                        transition: .4s;
                                    }

                                input:checked + .slider {
                                    background-color: #2196F3;
                                }

                                input:focus + .slider {
                                    box-shadow: 0 0 1px #2196F3;
                                }

                                input:checked + .slider:before {
                                    -webkit-transform: translateX(26px);
                                    -ms-transform: translateX(26px);
                                    transform: translateX(26px);
                                }

                                /* Rounded sliders */
                                .slider.round {
                                    border-radius: 34px;
                                }

                                    .slider.round:before {
                                        border-radius: 50%;
                                    }
                            </style>
                            <div class="row " style="margin-top:15px; text-align:center">

                                <label id="lableToggle" style="display:inline-block" class="switch">
                                    <input type="checkbox">
                                    <span class="slider round"></span>
                                </label>

                            </div>


                        </div>
                        <script>
                            $(".switch").click(function () {
                                alet("aaa");
                            })
                        </script>


                    </div>
                </div>
            </div>

            <div class="containerofform" id="raveshpardakht">
                <div class="header"><p> روش پرداخت</p></div>
                <div class="sectionBody">
                    <div class="row " style="direction:rtl;">
                        @*<div class="col-lg-6 col-sm-6 " id="inplace" style="cursor:pointer; float:right">
                                <div class="halfrow">
                                    <i class="fa fa-check banky"></i>

                                    <p>پرداخت درمحل</p>
                                </div>

                            </div>*@


                        @{
                            if (@System.Configuration.ConfigurationManager.AppSettings["dargah"].Contains("inplace"))
                            {
                                <div class="col-lg-6 col-sm-6 " id="inplace" style="cursor:pointer; float:right">
                                    <div class="halfrow">
                                        <i class="fa fa-check banky" style="display:none"></i>

                                        <p>پرداخت در محل</p>
                                    </div>

                                </div>
                            }
                            if (@System.Configuration.ConfigurationManager.AppSettings["dargah"].Contains("zarin"))
                            {
                                <div class="col-lg-6 col-sm-6 " id="internet" style="cursor:pointer; float:right">
                                    <div class="halfrow">
                                        <i class="fa fa-check banky" style="display:none"></i>

                                        <p>زرین پال</p>
                                    </div>

                                </div>
                            }

                            if (@System.Configuration.ConfigurationManager.AppSettings["dargah"].Contains("mellat"))
                            {
                                <div class="col-lg-6 col-sm-6 " id="mellat" style="cursor:pointer; float:right">
                                    <div class="halfrow ">
                                        <i class="fa fa-check banky" style="display:none"></i>

                                        <p>بانک ملت</p>
                                    </div>

                                </div>
                            }
                            if (@System.Configuration.ConfigurationManager.AppSettings["dargah"].Contains("pasargad"))
                            {
                                <div class="col-lg-6 col-sm-6 " id="pasargad" style="cursor:pointer; float:right">
                                    <div class="halfrow">
                                        <i class="fa fa-check banky" style="display:none"></i>
                                        <p>بانک پاسارگاد</p>
                                    </div>
                                </div>
                            }
                            if (@System.Configuration.ConfigurationManager.AppSettings["dargah"].Contains("wallet"))
                            {
                                @*<div class="col-lg-6 col-sm-6 " id="Wallet" style="cursor:pointer; float:right">
                                        <div class="halfrow">
                                            <i class="fa fa-check banky" style="display:none"></i>

                                            <p>کیف پول</p>
                                        </div>

                                    </div>*@
                            }
                        }



                    </div>
                </div>
            </div>




            @*<div id="finalconfirm" class="btn-link-spoiler btn-link-spoiler--edit">
                    تایید اطلاعات
                </div>*@
            <div style="width:100%; text-align:center; padding:20px">
                <div id="finalconfirm" class="btn btn-success" style=" width: 60%;  padding: 10px; font-size: 14px; margin: 0 auto;">
                    پرداخت
                </div>
            </div>

        </div>
        @{
            var value = "final" + @Model.times[0].hours[0].ID;
            <input hidden id="hourid" name="hourid" value=@value />
            <input hidden id="payment" name="payment" value="" />
            <input hidden id="addressID" name="addressID" value="" />
        }

        <div style="margin:30px 0px 30px 0px"></div>
    </form>
}





@if (@ViewBag.error != null)
{
    <script>
            var error = '@ViewBag.error';
            toastr.options = {
                "debug": false,
                "positionClass": "toast-top-center",
                "onclick": null,
                "fadeIn": 300,
                "fadeOut": 1000,
                "timeOut": 5000,
                "extendedTimeOut": 1000
            }
            toastr.error(error);
    </script>
}


