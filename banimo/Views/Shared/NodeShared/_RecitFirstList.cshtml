@model banimo.ViewModel.RecietVM
@*@model PagedList.IPagedList<AdminPanelBoom.ViewModel.orderdetail>*@
@using PagedList.Mvc;
<link href="~/Content/PagedList.css" rel="stylesheet" type="text/css" />
@{
    ViewBag.Title = "لیست رسید ها";
}


@*@using (Html.BeginForm("Index", "Student", FormMethod.Get))
    {
        <p>
            Find by name: @Html.TextBox("SearchString", ViewBag.CurrentFilter as string)
            <input type="submit" value="Search" />
        </p>
    }*@
@{

    <style>
        .activated {
            background-color: #d59e9e !important;
        }
    </style>
    <!-- Modal -->
    <p style="display:none" id="modalValue"></p>
    <p style="display:none" id="productValue"></p>
    //newRecietModal
    <div id="myModal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                @*<div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal">&times;</button>
                      <h4 class="modal-title">Modal Header</h4>
                    </div>*@
                <div class="modal-body">
                    <p id="modalmessage">آیا از حذف محصول اطمینان دارید</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal" style="margin:7px;">خیر</button>
                    <button id="confirmdeleteReciet" type="button" class="btn btn-default" data-dismiss="modal" style="margin: 7px;">بله</button>
                    <script>
                        $("#confirmdeleteReciet").click(function () {
                            $("#myModal").modal('hide');
                            var id = $("#modalValue").text();
                            var rc = "rc" + id;
                            $.ajax({
                                url: '/Core/confirmdeleteReciet',
                                dataType: 'html',
                                data: {
                                    recietID: id,
                                },
                                success: function (data) {
                                    if (data != "200") {
                                        toastr.options = {
                                            "debug": false,
                                            "positionClass": "toast-top-center",
                                            "onclick": null,
                                            "fadeIn": 300,
                                            "fadeOut": 1000,
                                            "timeOut": 5000,
                                            "extendedTimeOut": 1000
                                        }
                                        toastr.error('امکان حذف سند وجود ندارد')

                                    }
                                    else {
                                        $("#" + rc).hide();
                                        toastr.options = {
                                            "debug": false,
                                            "positionClass": "toast-top-center",
                                            "onclick": null,
                                            "fadeIn": 300,
                                            "fadeOut": 1000,
                                            "timeOut": 5000,
                                            "extendedTimeOut": 1000
                                        }
                                        toastr.success('آیتم مورد نظر حذف شد')

                                    }


                                },
                                error: function () {
                                    alert("nashod")
                                }
                            });
                        })

                    </script>
                </div>
            </div>
        </div>
    </div>


    <div id="daemModal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                @*<div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal">&times;</button>
                      <h4 class="modal-title">Modal Header</h4>
                    </div>*@
                <div class="modal-body">
                    <p id="modalmessage">آیا از دائم نمودن سند اطمینان دارید؟</p>
                </div>
                <div class="modal-footer">
                    <button id="cancelDaem" type="button" class="btn btn-default" data-dismiss="modal" style="margin:7px;">خیر</button>
                    <button id="confirmDaem" type="button" class="btn btn-default" data-dismiss="modal" style="margin: 7px;">بله</button>
                    <script>
                        $("#cancelDaem").click(function () {
                            var Prodcutid = $("#modalValue").text();
                            var productValue = $("#productValue").text();
                            var rc = "rc" + Prodcutid;
                            $("#" + rc).find('.daemHolder .daem').prop("checked", false);
                        })
                        $("#confirmDaem").click(function () {
                            $("#daemModal").modal('toggle');
                            var Prodcutid = $("#modalValue").text();
                            var productValue = $("#productValue").text();
                            var rc = "rc" + Prodcutid;

                            var iteCheck = $("#".rc).find('#daemHolder .daem');
                            $.ajax({
                                url: '/Core/ChangeProductStatus',
                                dataType: 'html',
                                data: {
                                    id: Prodcutid,
                                    value: productValue,
                                    type: "3"

                                },
                                success: function (data) {
                                    if (data == "200") {
                                        toastr.options = {
                                            "debug": false,
                                            "positionClass": "toast-top-center",
                                            "onclick": null,
                                            "fadeIn": 300,
                                            "fadeOut": 1000,
                                            "timeOut": 5000,
                                            "extendedTimeOut": 1000,


                                        }
                                        toastr.success('با موفقیت انجام شد');

                                    }
                                    else {
                                        if (productValue == "0") {

                                            $("#" + rc).find('.daemHolder .daem').prop("checked", true);
                                        }
                                        else {
                                            $("#" + rc).find('.daemHolder .daem').prop("checked", false);

                                            //iteCheck.prop("checked", false);


                                        }


                                        toastr.options = {
                                            "debug": false,
                                            "positionClass": "toast-top-center",
                                            "onclick": null,
                                            "fadeIn": 300,
                                            "fadeOut": 1000,
                                            "timeOut": 5000,
                                            "extendedTimeOut": 1000,


                                        }
                                        toastr.error(data)

                                    }

                                },
                                error: function () {

                                }
                            });
                        })

                    </script>
                </div>
            </div>
        </div>
    </div>

}



@if (Model.recietList != null)
{

    <div class="row">
        <div class="panel-body">
            <div id="morris-area-chart">
                <div style="overflow:auto">
                    <table class="table all-package theme-table table-product dataTable no-footer" id="table_id" style="">
                        <thead>
                            <tr>
                                <th>
                                    ردیف

                                </th>
                                <th>
                                    شماره عطف
                                </th>
                                <th>
                                    شماره سند
                                </th>
                                <th>
                                    تاریخ
                                </th>
                                <th>
                                    توضیحات
                                </th>
                                <th>
                                    ثبت اولیه
                                </th>
                                <th>
                                    ثبت نهایی
                                </th>
                                <th>
                                    ثبت دائم
                                </th>
                                @*<th class="sorting_disabled" rowspan="1" colspan="1" style="width: 100px;">Vendor ID</th>
                                    <th class="sorting_disabled" rowspan="1" colspan="1" style="width: 170px;">Venor Title</th>
                                    <th class="sorting_disabled" rowspan="1" colspan="1" style="width: 70px;"> Inactive?</th>
                                    <th class="sorting_disabled" rowspan="1" colspan="1" style="width: 70px;"> Popular?</th>
                                    <th class="sorting_disabled" rowspan="1" colspan="1" style="width: 70px;"> Recommended?</th>
                                    <th class="sorting_disabled" rowspan="1" colspan="1" style="width: 170px;"> freeDelivry?</th>*@

                                <th class="sorting_disabled" rowspan="1" colspan="1" style="width: 170px;">Option</th>
                            </tr>
                        </thead>

                        <tbody>
                            @foreach (var item in Model.recietList)
                            {
                                string cls = "odd";
                                int index = Model.recietList.IndexOf(item) + 1;
                                string rcid = "rc" + item.ID;

                                if (Model.recietList.IndexOf(item) + 1 % 2 == 0)
                                {
                                    cls = "even";
                                }

                                <tr class="@cls" class="sanadParent" id="@rcid">
                                    <td>@index</td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.atf)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.num)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.date)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.description)
                                    </td>

                                    <td style="text-align: center;">
                                        @if (item.status == "1")
                                        {


                                            <input id=@item.ID type="checkbox" class="avalie" checked />
                                        }
                                        else
                                        {
                                            string disabled = "";
                                            if (item.status == "2" || item.status == "3")
                                            {
                                                disabled = "disabled";
                                                <input id=@item.ID type="checkbox" class="avalie" selected @disabled />

                                            }
                                            else
                                            {
                                                <input id=@item.ID type="checkbox" class="avalie" />
                                            }
                                        }
                                    </td>

                                    <td style="text-align: center;">
                                        @if (item.status == "2")
                                        {
                                            <input id=@item.ID type="checkbox" class="final" checked />
                                        }
                                        else
                                        {
                                            string disabled = "";
                                            if (item.status == "3")
                                            {
                                                disabled = "disabled";

                                                <input id=@item.ID type="checkbox" checked class="final" disabled />
                                            }
                                            else
                                            {
                                                <input id=@item.ID type="checkbox" class="final" />
                                            }


                                        }
                                    </td>
                                    <td style="text-align: center;" class="daemHolder">
                                        @{

                                            if (item.status == "3")
                                            {
                                                <input id=@item.ID type="checkbox" class="daem" checked />
                                            }
                                            else
                                            {
                                                <input id=@item.ID type="checkbox" class="daem" />
                                            }

                                        }
                                    </td>





                                    <td>
                                        <ul>
                                          
                                            <li idattr='@item.ID' class="showRecite">
                                                <a href="order-detail.html">
                                                    <i class="ri-eye-line"></i>
                                                </a>
                                            </li>
                                            @if (item.status == "0")
                                            {
                                                <li idattr='@item.ID' class="editRecite">
                                                    <a href="javascript:void(0)">
                                                        <a href="edit/@item.ID">

                                                            <i id=@item.ID class="ri-pencil-line "></i>
                                                        </a>

                                                    </a>
                                                </li>
                                            }


                                            <li>
                                                @{
                                                    if (item.status != "2" && item.status != "3" && item.status != "1")
                                                    {
                                                        var classname = "deleteproduct" + item.ID;
                                                        <a @classname id=@item.ID href="javascript:void(0)" data-bs-toggle="modal" data-bs-target="#myModal">
                                                            <i class="ri-delete-bin-line deleteproduct" id=""></i>
                                                        </a>
                                                        <script>
                                                        var classname = "deleteproduct" + @item.ID

                                                            $("." + classname).click(function () {
                                                                $("#modalValue").text(this.id);
                                                            });
                                                        </script>
                                                    }

                                                }

                                            </li>
                                        </ul>
                                    </td>


                                </tr>
                            }



                        </tbody>
                    </table>






                </div>
            </div>
        </div>
    </div>
   
}




<br />
@*Page @(Model.PageCount <Model.PageNumber ? 0 : Model.PageNumber) of @Model.PageCount*@
<p id="selectedForServer"></p>

<script>
    $("#newRecietModalIcon").click(function () {
        $("#newRecietModal").modal('toggle');
    })
    $(".editRecite").click(function () {

        var id = $(this).attr('idattr');
        $("#recietID").val(id);
        $("#fromADD").val("edit");
        $.ajax({
            url: '/Core/getRecietArticle',
            dataType: '',
            data: {
                id: id,
                type: "1"
            },
            success: function (data) {

                $("#EditarticleHolder").html(data);
            },
            error: function () {

            }
        });
    })
    $(".chapRecite").click(function () {
        var id = $(this).attr('idattr');
        var url = '/Core/getRecietArticlePaper?id=' + id;
        window.open(
            url, '_blank' // <- This is what makes it open in a new window.
        );

    })
    $(".showRecite").click(function () {
        $(".sanadParent").each(function () {
            $(this).removeClass("activated")
        });
        $(this).parent().parent().addClass("activated")
        var id = $(this).attr('idattr');
        $("#recietID").val(id);
        $.ajax({
            url: '/Core/getRecietArticle',
            dataType: 'html',
            data: {
                id: id,
            },
            success: function (data) {
                $("#EditarticleHolder").html(data);
                $([document.documentElement, document.body]).animate({
                    scrollTop: $("#EditarticleHolder").offset().top
                }, 1000);

            },
            error: function () {

            }
        });

    })
</script>
<script>

    $(".avalie").click(function () {
        var iteCheck = $(this);
        if ($(this).is(':checked')) {
            var productValue = "1";
        }
        else {
            var productValue = "0";
        }
        var Prodcutid = $(this).attr("id");

        $.ajax({
            url: '/Core/ChangeProductStatus',
            dataType: 'html',
            data: {
                id: Prodcutid,
                value: productValue,
                type: "1"
            },
            success: function (data) {

                if (data == "200") {
                    toastr.options = {
                        "debug": false,
                        "positionClass": "toast-top-center",
                        "onclick": null,
                        "fadeIn": 300,
                        "fadeOut": 1000,
                        "timeOut": 5000,
                        "extendedTimeOut": 1000,


                    }
                    toastr.success('با موفقیت انجام شد')
                }
                else {
                    iteCheck.prop("checked", false)
                    toastr.options = {
                        "debug": false,
                        "positionClass": "toast-top-center",
                        "onclick": null,
                        "fadeIn": 300,
                        "fadeOut": 1000,
                        "timeOut": 5000,
                        "extendedTimeOut": 1000,


                    }
                    toastr.error(data)
                }
            },
            error: function () {

            }
        });
    })
    $(".final").click(function () {

        var iteCheck = $(this);
        if ($(this).is(':checked')) {
            var productValue = "1";
        }
        else {
            var productValue = "0";
        }
        var Prodcutid = $(this).attr("id");

        $.ajax({
            url: '/Core/ChangeProductStatus',
            dataType: 'html',
            data: {
                id: Prodcutid,
                value: productValue,
                type: "2"
            },
            success: function (data) {
                if (data == "200") {
                    toastr.options = {
                        "debug": false,
                        "positionClass": "toast-top-center",
                        "onclick": null,
                        "fadeIn": 300,
                        "fadeOut": 1000,
                        "timeOut": 5000,
                        "extendedTimeOut": 1000,


                    }
                    toastr.success('با موفقیت انجام شد')
                }
                else {
                    iteCheck.prop("checked", false)
                    toastr.options = {
                        "debug": false,
                        "positionClass": "toast-top-center",
                        "onclick": null,
                        "fadeIn": 300,
                        "fadeOut": 1000,
                        "timeOut": 5000,
                        "extendedTimeOut": 1000,


                    }
                    toastr.error(data)
                }

            },
            error: function () {

            }
        });
    })
    $(".daem").click(function () {
        var iteCheck = $(this);
        if ($(this).is(':checked')) {
            var productValue = "1";
        }
        else {
            var productValue = "0";
        }
        $("#productValue").text(productValue);
        var Prodcutid = $(this).attr("id");
        $("#modalValue").text(Prodcutid);
        if (productValue == "0") {
            iteCheck.prop("checked", true)
            toastr.options = {
                "debug": false,
                "positionClass": "toast-top-center",
                "onclick": null,
                "fadeIn": 300,
                "fadeOut": 1000,
                "timeOut": 5000,
                "extendedTimeOut": 1000,


            }
            toastr.error("شما قادر به انجام عملیات نیستید")
        }
        else {
            $("#daemModal").modal('toggle');
        }

    })

</script>


<div class="row">
    @{
        var total = (Convert.ToInt32(Model.count) / 12);
        var remain = (Convert.ToInt32(Model.count) % 12);
        if (remain != 0)
        {
            total = total + 1;
        }
        var activ = Convert.ToInt32(Model.current);
        var activminus2 = activ - 2;
        var activminus1 = activ - 1;
        var activplus1 = activ + 1;
        var activplus2 = activ + 2;



        if ((total - activ) > 3 & activ > 3)
        {
            <ul class="pagination">
                <li><a>«</a></li>
                <li style="cursor:pointer" class="pagingnumberforall"><a>1</a></li>
                @if (activminus2 > 2)
                {
                    <li><a>...</a></li>
                }
                <li style="cursor:pointer" class="pagingnumberforall"><a>@activminus2</a></li>
                <li style="cursor:pointer" class="pagingnumberforall"><a>@activminus1</a></li>
                <li class="active"><a>@activ</a></li>
                <li style="cursor:pointer" class="pagingnumberforall"><a>@activplus1</a></li>
                <li style="cursor:pointer" class="pagingnumberforall"><a>@activplus2</a></li>
                <li><a> ...</a></li>
                <li><a>@total</a></li>
                <li><a>»</a></li>
            </ul>
        }
        else if ((total - activ > 3) && !(activ > 3))
        {
            <ul class="pagination">
                @for (int i = 1; i < activ; i++)
                {
                    <li style="cursor:pointer" class="pagingnumberforall"><a>@i</a></li>
                }
                <li class="active"><a>@activ </a></li>
                <li style="cursor:pointer" class="pagingnumberforall"><a>@activplus1</a></li>
                <li style="cursor:pointer" class="pagingnumberforall"><a>@activplus2</a></li>
                <li><a href="#">...</a></li>
                <li style="cursor:pointer" class="pagingnumberforall"><a>@total</a></li>
                <li><a href="#">»</a></li>
            </ul>

        }
        else if (!(total - activ > 3) && activ > 3)
        {
            <ul class="pagination">
                <li><a>«</a></li>
                <li style="cursor:pointer" class="pagingnumberforall"><a>1</a></li>
                <li><a>...</a></li>
                <li style="cursor:pointer" class="pagingnumberforall"><a>@activminus2</a></li>
                <li style="cursor:pointer" class="pagingnumberforall"><a>@activminus1</a></li>
                <li style="cursor:pointer" class="active"><a>@activ </a></li>
                @for (int i = activ + 1; i <= total; i++)
                {
                    <li style="cursor:pointer" class="pagingnumberforall"><a>@i</a></li>
                }
                <li><a>»</a></li>
            </ul>

        }
        else if (total > 1 && !((total - activ) > 3) && !(activ > 3))
        {

            <ul class="pagination">
                @for (int i = 1; i < activ; i++)
                {
                    <li style="cursor:pointer" class="pagingnumberforall"><a>@i</a></li>
                }
                <li class="active"><a href="#">@activ</a></li>
                @for (int i = activ + 1; i <= total; i++)
                {
                    <li style="cursor:pointer" class="pagingnumberforall"><a>@i</a></li>
                }
            </ul>

        }

    }
    <script>

        $(".pagingnumberforall").click(function () {

            var num = this.textContent;
            $("#loading").show();
            getlofo(num)
        })

    </script>

</div>



<div id="EditarticleHolder">

</div>