@model banimo.ViewModel.MainFactorListVM

<p style="display:none" id="parentValue"></p>
<p style="display:none" id="factorValue"></p>
<style>
    td {
        padding: 15px;
        text-align: center;
        border: 1px solid #eee;
    }
</style>
<div class="modal fade" id="FsayerModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg  modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body">
                <input id="FparentID" hidden />
                <div id="FsayerHolder"></div>
               
                <div class="button-box">
                    <button type="button" class="btn btn--no" data-bs-dismiss="modal" data-bs-original-title="" title="">@Resources.res.cancel</button>
                    <button id="FconfirmSayer" type="button" class="btn  btn--yes btn-primary" data-bs-original-title="" title="">@Resources.res.OK</button>
                    <script>
                        $("#FconfirmSayer").click(function () {
                            //$("#residModal").modal('hide');

                            var dPercent = $("#FdPercent").val();
                            var dPrice = $("#FdPrice").val();
                            var TPercent = $("#FTPercent").val();
                            var TPrice = $("#FTPrice").val();
                            var OPercent = $("#FOPercent").val();
                            var OPrice = $("#FOPrice").val();
                            var HPercent = $("#FHPercent").val();
                            var HPrice = $("#FHPrice").val();
                            var parentID = $("#FparentID").val();



                            $.ajax({
                                url: '/Node/setFactorSayer',
                                dataType: 'html',
                                data: {
                                    dPercent: dPercent,
                                    dPrice: dPrice,
                                    TPercent: TPercent,
                                    TPrice: TPrice,
                                    OPercent: OPercent,
                                    OPrice: OPrice,
                                    HPercent: HPercent,
                                    HPrice: HPrice,
                                    ID: parentID,
                                    isFroosh: "1"


                                },
                                success: function (data) {
                                    if (data == "error") {
                                        toastr.options = {
                                            "debug": false,
                                            "positionClass": "toast-top-center",
                                            "onclick": null,
                                            "fadeIn": 300,
                                            "fadeOut": 1000,
                                            "timeOut": 5000,
                                            "extendedTimeOut": 1000
                                        }
                                        toastr.error('خطا')
                                    }
                                    else {
                                        toastr.options = {
                                            "debug": false,
                                            "positionClass": "toast-top-center",
                                            "onclick": null,
                                            "fadeIn": 300,
                                            "fadeOut": 1000,
                                            "timeOut": 5000,
                                            "extendedTimeOut": 1000
                                        }
                                        toastr.success('با موفقیت انجام شد')

                                        $("#FsayerModal").modal('toggle');

                                        //window.location.reload();
                                    }


                                },
                                error: function () {
                                    alert("nashod")
                                }
                            });
                        })

                    </script>
                </div>
            </div>
        </div>
    </div>
</div>

@{
    int count = @Model.mainFactor.Count() + 1;

    double sumf = Model.mainFactor.Sum(x => x.price * x.count);
    double sum = Model.mainFactor.Sum(x => x.price);
    double sumcount = Model.mainFactor.Sum(x => x.count);




    <div class="row">
        <div class="col-sm-12">

            <div class="card">
                <div class="card-body">


                    <div class="title-header option-title">
                        <h5>Sales Factor List</h5>
                    </div>
                    <div style="overflow:auto ; max-height:400px; overflow-y:scroll">
                        <table class="table all-package theme-table table-product dataTable no-footer" id="table_id" style="">
                            <thead>
                                <tr>


                                    <th class="sorting_disabled" rowspan="1" colspan="1" style="width: 170px;">col</th>
                                    <th class="sorting_disabled" rowspan="1" colspan="1" style="width: 170px;">Factor Numbere</th>
                                    <th class="sorting_disabled" rowspan="1" colspan="1" style="width: 170px;"> time</th>
                                    <th class="sorting_disabled" rowspan="1" colspan="1" style="width: 170px;"> final</th>
                                    <th class="sorting_disabled" rowspan="1" colspan="1" style="width: 170px;">Operation</th>
                                </tr>
                            </thead>

                            <tbody>



                                @foreach (var item in Model.mainFactor)
                                {
                                    string image = "";
                                    int i = Model.mainFactor.IndexOf(item) + 1;
                                    string deleteid = item.ID;
                                    string cls = "odd";
                                    if (Model.mainFactor.IndexOf(item) + 1 % 2 == 0)
                                    {
                                        cls = "even";
                                    }

                                    <tr id="@item.ID" class="@cls">

                                        <td>@i</td>
                                        <td class="Ffpnumber">@item.number</td>
                                        <td class="Ffptimestamp">@item.timestamp</td>
                                        <td class="FdaemHolder">
                                            @if (item.status != "1")
                                            {
                                                <input type="checkbox" class="Fdaem checkbox_animated check-it11" />
                                            }
                                            else
                                            {
                                                <input type="checkbox" checked class="Fdaem checkbox_animated check-it11" />
                                            }

                                        </td>
                                        <td>
                                            <ul>
                                                <li>
                                                    <a href="javascript:void(0)">
                                                        <a href="#">

                                                            <i id=@item.ID class="ri-file-2-line FviewItem"></i>
                                                        </a>

                                                    </a>
                                                </li>
                                                @if (item.status != "1")
                                                {
                                                    <li >
                                                        <a href="javascript:void(0)">
                                                            <i id=@item.ID class="ri-money-cny-box-fill FviewSayer"></i>

                                                        </a>
                                                    </li>
                                                    <li>
                                                        <a href="javascript:void(0)">
                                                            <i id=@item.ID class="ri-pencil-line FeditFactorParent"></i>

                                                        </a>
                                                    </li>
                                                    <li>
                                                        <a href="javascript:void(0)">
                                                            <i id=@item.ID class="ri-delete-bin-line FdeleteFactorParent"></i>

                                                        </a>
                                                    </li>
                                                }


                                            </ul>
                                        </td>


                                    </tr>
                                }



                            </tbody>
                        </table>






                    </div>
                </div>
            </div>
        </div>
    </div>


}










<script>
    $(".addNewResidHavale").click(function () {

        $("#FaddNewResidHavaleModal").modal('toggle');
    })
    $(".FeditFactorParent").click(function () {
        var ele = $(this).parent().parent();
        var number = ele.find(".Ffpnumber").text();
        var ID = ele.attr('id');
        var nodeID = ele.attr('nodeID')
        var anbarID = ele.find(".Ffpanbar").attr('anbarID');
        var fppartner = ele.find(".Ffppartner").attr('partnerID');
        var timestamp = ele.find(".Ffptimestamp").text();
        var fpdesc = ele.find(".Ffbdesc").text();





        $("#FnodeIDAddParentM").val(nodeID);
        $("#FpartnerItemMM").val(fppartner.trim());
        $("#FanabrItemM").val(anbarID);
        $("#FrecieverM").val(fpdesc);
        $("#FfactorNumberM").val(number);
        $("#FnewFactorIDM").val(ID);

        $("#FeditPurchaseFactor").modal('toggle');


    })
</script>
<script>

    $(".Fdaem").click(function () {

        var iteCheck = $(this);
        if ($(this).is(':checked')) {
            var productValue = "1";
        }
        else {
            var productValue = "0";
        }
        $("#FfactorValue").text(productValue);
        var factorParentid = $(this).parent().parent().attr('id');
        $("#FparentValue").text(factorParentid);
        if (productValue == "0") {
            iteCheck.prop("checked", true)
            toastr.options = {
                "debug": false,
                "positionClass": "toast-top-center",
                "onclick": null,
                "fadeIn": 300,
                "fadeOut": 1000,
                "timeOut": 5000,
                "extendedTimeOut": 1000,


            }
            toastr.error("شما قادر به انجام عملیات نیستید")
        }
        else {
            $("#FdaemModal").modal('toggle');
        }

    })
    $(".FviewSayer").click(function () {

        $("#FsayerHolder").html("");
        //$(this).parent().parent().parent().find('tr').css("background-color", "")
        //$(this).parent().parent().css("background-color", "red");
        var factorParent = $(this).attr('id');
        $("#FparentID").val(factorParent);
        $.ajax({
            url: '/Node/FgetFactorSayer',
            dataType: 'html',
            data: {
                ID: factorParent,
            },
            success: function (data) {

                $("#FsayerHolder").html(data);
            }

        })
        $("#FsayerModal").modal('toggle');



    })
    $(".FviewItem").click(function () {
        $("#FcallFrom").val("0");
        //$(this).parent().parent().parent().find('tr').css("background-color", "")
        //$(this).parent().parent().css("background-color", "red")


        var factorParent = $(this).attr('id');


        $("#FnewFactorID").val(factorParent);
        $.ajax({
            url: '/Node/FreturnDraftListFactor',
            dataType: 'html',
            data: {
                parentID: factorParent,
            },
            success: function (data) {



                $("#FFactorListSection3").html(data);
                $([document.documentElement, document.body]).animate({
                    scrollTop: $("#FFactorListSection3").offset().top
                }, 1000);
            },
            error: function () {

            }
        });
    })

    $(".editItem").click(function () {
        $(this).parent().parent().find(".phase1").toggle();
        $(this).parent().parent().find(".phase2").toggle();

    })
    $(".editItemVerif").click(function () {


        var amani = $(this).parent().parent().find(".amanicheckbox").is(":checked");
        var factorPrice = $(this).parent().parent().find(".factorPrice").val();
        var factorPercent = $(this).parent().parent().find(".factorPercent").val();
        var id = $(this).parent().parent().attr("id");

        $.ajax({
            url: '/Core/editFactor',
            dataType: 'html',
            data: {
                amani: amani,
                factorPrice: factorPrice,
                factorPercent: factorPercent,
                id: id,
            },
            success: function (data) {

                $("#verifyCodeingTran").click();
            }

        })


    })

</script>



@*@foreach (var item in Model.mainFactor)
    {
        string image = "";
        int i = Model.mainFactor.IndexOf(item) + 1;
        string deleteid = item.ID;
        <tr nodeID="@item.nodeID" id="@deleteid">

            <td>@i</td>
            <td class="Ffpnumber">@item.number</td>
            <td anbarID="@item.anbarID" class="Ffpanbar">@item.anbarTitle</td>
            <td>@item.typeTitle</td>

            <td class="Ffppartner" partnerID=" @item.partnerID">
                <span>@item.partnerTitle</span>
            </td>




            <td class="Ffptimestamp">@item.timestamp</td>
            <td class="Ffbdesc">@item.deliverName</td>
            <td class="FdaemHolder">
                @if (item.status != "1")
                {
                    <input type="checkbox" class="Fdaem" />
                }
                else
                {
                    <input type="checkbox" checked class="Fdaem" />
                }

            </td>
            <td>
                <div class="btn btn-success FviewItem ">مشاهده اقلام</div>


            </td>
            <td>
                <div class="btn btn-success FviewSayer ">مشاهده سایر</div>


            </td>
            <td>
                @if (item.status == "1")
                {
                    <div class="btn btn-danger FdeleteFactorParent">حذف</div>

                }
            </td>
            <td>
                @if (item.status == "1")
                {
                    <div class="btn btn-danger FeditFactorParent">ویرایش</div>

                }
            </td>


        </tr>
    }*@