@model banimo.ViewModel.MainFactorListVM

<p style="display:none" id="parentValue"></p>
<p style="display:none" id="factorValue"></p>
<style>
    td {
        padding: 15px;
        text-align: center;
        border: 1px solid #eee;
    }
</style>
<div class="modal fade" id="sayerModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                فرم ثبت سایر هزینه ها
            </div>
            <div class="modal-body">

                <input id="parentID" hidden />
                <div id="sayerHolder"></div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" style="margin:7px;">لغو</button>
                <button id="confirmSayer" type="button" class="btn btn-default" style="margin: 7px;">تایید</button>

                <script>
                    $("#confirmSayer").click(function () {
                        //$("#residModal").modal('hide');

                        var dPercent = $("#dPercent").val();
                        var dPrice = $("#dPrice").val();
                        var TPercent = $("#TPercent").val();
                        var TPrice = $("#TPrice").val();
                        var OPercent = $("#OPercent").val();
                        var OPrice = $("#OPrice").val();
                        var HPercent = $("#HPercent").val();
                        var HPrice = $("#HPrice").val();
                        var parentID = $("#parentID").val();
                        if ($('#Tcheck').is(":checked")) {
                            var Tbaha = "1";
                        }
                        else {
                            var Tbaha = "0";
                        }
                        if ($('#Ocheck').is(":checked")) {
                            var Obaha = "1";
                        }
                        else {
                            var Obaha = "0";
                        }
                        if ($('#Hcheck').is(":checked")) {
                            var Hbaha = "1";
                        }
                        else {
                            var Hbaha = "0";
                        }
                        if ($('#dcheck').is(":checked")) {
                            var dbaha = "1";
                        }
                        else {
                            var dbaha = "0";
                        }



                        $.ajax({
                            url: '/Core/setFactorSayer',
                            dataType: 'html',
                            data: {
                                dPercent: dPercent,
                                dPrice: dPrice,
                                TPercent: TPercent,
                                TPrice: TPrice,
                                OPercent: OPercent,
                                OPrice: OPrice,
                                HPercent: HPercent,
                                HPrice: HPrice,
                                ID: parentID,
                                dbaha: dbaha,
                                Hbaha: Hbaha,
                                Obaha: Obaha,
                                Tbaha: Tbaha,


                            },
                            success: function (data) {
                                if (data == "error") {
                                    toastr.options = {
                                        "debug": false,
                                        "positionClass": "toast-top-center",
                                        "onclick": null,
                                        "fadeIn": 300,
                                        "fadeOut": 1000,
                                        "timeOut": 5000,
                                        "extendedTimeOut": 1000
                                    }
                                    toastr.error('خطا')
                                }
                                else {
                                    toastr.options = {
                                        "debug": false,
                                        "positionClass": "toast-top-center",
                                        "onclick": null,
                                        "fadeIn": 300,
                                        "fadeOut": 1000,
                                        "timeOut": 5000,
                                        "extendedTimeOut": 1000
                                    }
                                    toastr.success('با موفقیت انجام شد')

                                    $("#sayerModal").modal('toggle');

                                    //window.location.reload();
                                }


                            },
                            error: function () {
                                alert("nashod")
                            }
                        });
                    })

                </script>
            </div>
        </div>
    </div>
</div>
<div id="deleteFactorPModel" class="modal fade" role="dialog">
    <div class="modal-dialog modal-lg">
        <!-- Modal content-->
        <div class="modal-content">
            @*<div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                  <h4 class="modal-title">Modal Header</h4>
                </div>*@
            <div class="modal-body">
                <p>آیا از حذف فاکتور مورد نظر اطمینان دارید</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" style="margin:7px;">لغو</button>
                <button id="deletButon" type="button" class="btn btn-default" data-dismiss="modal" style="margin: 7px;">تایید</button>

            </div>
        </div>
    </div>
</div>
<div class="row">
    <div style="overflow-x:auto;padding:10px">
        <div class="panel panel-default">
            <div class="panel-heading" style="    background-image: -webkit-linear-gradient(top,#2a85ae 0,#246388 100%) !important;
    background-image: -o-linear-gradient(top,#2a85ae 0,#246388 100%) !important;
    background-image: -webkit-gradient(linear,left top,left bottom,from(#2a85ae),to(#246388)) !important;
    background-image: linear-gradient(to bottom,#2a85ae 0,#246388 100%) !important;color: #fff">
                <h3 class="panel-title"><i class="fa fa-shopping-basket fa-fw"></i> لیست فاکتورها    @*<i id="print" style="cursor:pointer; float:left" class="fa fa-print"></i>*@  @*<i style="cursor:pointer; float:left; margin-left:20px" class="fa fa-plus addNewResidHavale"></i>*@</h3>



            </div>
            @if (Model.mainFactor != null)
            {
                <div class="panel-body">
                    <div id="morris-area-chart">
                        @{
                            <div style="overflow:auto">
                                <table class="table table-bordered table-hover table-striped">
                                    <thead>
                                        <tr>
                                            <th>ردیف</th>
                                            <th>شماره فاکتور</th>
                                            <th>نام انبار</th>
                                            <th>نوع سند</th>
                                            <th>طرف حساب</th>
                                            <th>زمان</th>
                                            <th>توضیحات</th>
                                            <th>نهایی</th>
                                            <th></th>

                                            <th></th>
                                            <th></th>

                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model.mainFactor)
                                        {
                                            string image = "";
                                            int i = Model.mainFactor.IndexOf(item) + 1;
                                            string deleteid = item.ID;
                                            <tr nodeID="@item.nodeID" id="@deleteid">

                                                <td>@i</td>
                                                <td class="fpnumber">@item.number</td>
                                                <td anbarID="@item.anbarID" class="fpanbar">@item.anbarTitle</td>
                                                <td>@item.typeTitle</td>

                                                <td class="fppartner" partnerID=" @item.partnerID">
                                                    <span>@item.partnerTitle</span>
                                                </td>




                                                <td class="fptimestamp">@item.timestamp</td>
                                                <td class="fbdesc">@item.deliverName</td>
                                                <td class="daemHolder">
                                                    @if (item.status != "1")
                                                    {
                                                        <input type="checkbox" class="daem" />
                                                    }
                                                    else
                                                    {
                                                        <input type="checkbox" checked class="daem" />
                                                    }

                                                </td>
                                                <td>
                                                    <div class="btn btn-success viewItem ">مشاهده اقلام</div>


                                                </td>
                                                <td>
                                                    <div class="btn btn-success viewSayer ">مشاهده سایر</div>


                                                </td>

                                                @*<td>
                                                        @if (item.status != "1")
                                                        {
                                                            <div class="btn btn-success editItem phase1">ویرایش</div>

                                                        }

                                                    </td>*@
                                                <td>
                                                    @if (item.status != "1")
                                                    {
                                                        <div class="btn btn-danger deleteFactorParent">حذف</div>

                                                    }
                                                </td>
                                                <td>
                                                    @if (item.status != "1")
                                                    {
                                                        <div class="btn btn-danger editFactorParent">ویرایش</div>

                                                    }
                                                </td>
                                            </tr>
                                        }
                                        @*<tr>
                                                @{
                                                    int count = @Model.mainFactor.Count() + 1;

                                                    double sum = Model.mainFactor.Sum(x => x.price * x.count);
                                                    double sumcount = Model.mainFactor.Sum(x => x.count);
                                                }
                                                <td>@count.ToString()</td>
                                                <td>جمع کل</td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td>
                                                    @sumcount
                                                </td>
                                                <td></td>

                                                <td>
                                                </td>
                                                <td></td>
                                            </tr>*@


                                    </tbody>
                                </table>
                            </div>
                        }
                    </div>
                </div>
            }
        </div>
    </div>
</div>



<script>
    var idtodelete = "";
    $(".deleteFactorParent").click(function () {
        $("#deleteFactorPModel").modal('toggle');
        var ele = $(this).parent().parent();
        idtodelete = ele.attr('id');
    })

    $("#deletButon").click(function () {
        $.ajax({
            url: '/Core/removeFactorParent',
            dataType: 'html',
            data: {
                id: idtodelete,
            },
            success: function (data) {
                if (data == "200") {
                    $("#" + idtodelete).remove();
                    $("#verifyCodeingTran").click();
                    toastr.options = {
                        "debug": false,
                        "positionClass": "toast-top-center",
                        "onclick": null,
                        "fadeIn": 300,
                        "fadeOut": 1000,
                        "timeOut": 5000,
                        "extendedTimeOut": 1000,


                    }
                    toastr.success("با موفقیت انجام شد")
                }
                else {
                    toastr.options = {
                        "debug": false,
                        "positionClass": "toast-top-center",
                        "onclick": null,
                        "fadeIn": 300,
                        "fadeOut": 1000,
                        "timeOut": 5000,
                        "extendedTimeOut": 1000,


                    }
                    toastr.error("این فاکتور دارای رسید/حواله می باشد")
                }


            }

        })
    })
    $(".addNewResidHavale").click(function () {

        $("#addNewResidHavaleModal").modal('toggle');

    })
    $(".editFactorParent").click(function () {
        var ele = $(this).parent().parent();
        var number = ele.find(".fpnumber").text();
        var ID = ele.attr('id');
        var nodeID = ele.attr('nodeID')
        var anbarID = ele.find(".fpanbar").attr('anbarID');
        var fppartner = ele.find(".fppartner").attr('partnerID');
        var timestamp = ele.find(".fptimestamp").text();
        var fpdesc = ele.find(".fbdesc").text();





        $("#nodeIDAddParentM").val(nodeID);
        $("#partnerItemMM").val(fppartner.trim());
        $("#anabrItemM").val(anbarID);
        $("#recieverM").val(fpdesc);
        $("#factorNumberM").val(number);
        $("#newFactorIDM").val(ID);

        $("#editPurchaseFactor").modal('toggle');


    })
</script>
<script>

    $(".daem").click(function () {

        var iteCheck = $(this);
        if ($(this).is(':checked')) {
            var productValue = "1";
        }
        else {
            var productValue = "0";
        }
        $("#factorValue").text(productValue);
        var factorParentid = $(this).parent().parent().attr('id');
        $("#parentValue").text(factorParentid);
        if (productValue == "0") {
            iteCheck.prop("checked", true)
            toastr.options = {
                "debug": false,
                "positionClass": "toast-top-center",
                "onclick": null,
                "fadeIn": 300,
                "fadeOut": 1000,
                "timeOut": 5000,
                "extendedTimeOut": 1000,


            }
            toastr.error("شما قادر به انجام عملیات نیستید")
        }
        else {
            $("#daemModal").modal('toggle');
        }

    })
    $(".viewSayer").click(function () {

        $("#sayerHolder").html("");
        //$(this).parent().parent().parent().find('tr').css("background-color", "")
        //$(this).parent().parent().css("background-color", "red");
        var factorParent = $(this).parent().parent().attr('id');
        $("#parentID").val(factorParent);
        $.ajax({
            url: '/Core/getFactorSayer',
            dataType: 'html',
            data: {
                ID: factorParent,
            },
            success: function (data) {

                $("#sayerHolder").html(data);
            }

        })
        $("#sayerModal").modal('toggle');



    })
    $(".viewItem").click(function () {
        $("#callFrom").val("0");
        $(this).parent().parent().parent().find('tr').css("background-color", "")
        $(this).parent().parent().css("background-color", "red")


        var factorParent = $(this).parent().parent().attr('id');
        $("#newFactorID").val(factorParent);
        $.ajax({
            url: '/Core/returnDraftListFactor',
            dataType: 'html',
            data: {
                parentID: factorParent,
            },
            success: function (data) {
                $("#kharidFactorListSection2").html(data);
                $([document.documentElement, document.body]).animate({
                    scrollTop: $("#kharidFactorListSection2").offset().top
                }, 1000);
            },
            error: function () {

            }
        });
    })

    $(".editItem").click(function () {
        $(this).parent().parent().find(".phase1").toggle();
        $(this).parent().parent().find(".phase2").toggle();

    })
    $(".editItemVerif").click(function () {


        var amani = $(this).parent().parent().find(".amanicheckbox").is(":checked");
        var factorPrice = $(this).parent().parent().find(".factorPrice").val();
        var factorPercent = $(this).parent().parent().find(".factorPercent").val();
        var id = $(this).parent().parent().attr("id");

        $.ajax({
            url: '/Core/editFactor',
            dataType: 'html',
            data: {
                amani: amani,
                factorPrice: factorPrice,
                factorPercent: factorPercent,
                id: id,
            },
            success: function (data) {

                $("#verifyCodeingTran").click();
            }

        })


    })

</script>