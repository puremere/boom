@model banimo.ViewModelPost.ProductListViewModel
@using Newtonsoft.Json;
@using banimo.Classes;


@{
    if (Model.products != null)
    {
        <div class="layout1" style="display:none">
            @foreach (var item in Model.products)
            {


                <div class="row g-0  rounded overflow-hidden flex-md-row mb-4  h-md-250 position-relative list-product-box">
                    <div class="col-auto d-none d-lg-block list-product-img">
                        <svg class="bd-placeholder-img" width="200" height="200" xmlns="http://www.w3.org/2000/svg"
                             role="img" aria-label="Placeholder: صورة مصغرة" preserveAspectRatio="xMidYMid slice"
                             focusable="false">
                            <title>Placeholder</title>
                            <rect width="100%" height="100%" fill="#55595c"></rect>
                            <text x="50%" y="50%" fill="#eceeef" dy=".3em">صورة مصغرة</text>
                        </svg>

                    </div>
                    <div class="col p-4 d-flex flex-column position-static list-product-detail-1">
                        <h4 class="mb-0"> هذه بطاقة أوسع مع نص داعم أدناه كمقدمة طبيعية لمحتوى إضافي.</h4>

                        <p class=" ">378,000 تومان</p>

                        <div class="list-product-detail-2">
                            <span class="fa fa-star checked"></span>
                            <span class="fa fa-star checked"></span>
                            <span class="fa fa-star checked"></span>
                            <span class="fa fa-star"></span>
                            <span class="fa fa-star"></span>
                            <span class="list-product-detail-3">24 رای</span>
                        </div>

                    </div>
                    <div class="col p-4 d-flex flex-column position-static list-product-detail-4">


                        <button class="price-small-shop">خرید</button>
                        <a href="#" target="_blank">نمایش سریع</a>

                    </div>

                </div>
            }
        </div>


        <div class="layout2">
            <div class="row row-cols-1 row-cols-sm-3 row-cols-md-4 g-4">
                @foreach (var item in Model.products)
                {
                    string imageurl = item.image.Trim(',').Split(',').First();
                    <div class="col">

                        <div class="card">
                            <div style="width:100%; height:200px; text-align:center">
                                <img src="@imageurl" style="max-width:100%; max-height:100%; object-fit:scale-down" />
                            </div>

                            <div class="card-body">
                                <p class="card-text">
                                   @item.title
                                </p>
                                <div class="d-flex justify-content-between align-items-center">

                                    <!--                                <small class="text-muted price-small">قیمت  </small>-->
                                    <span class="price-small-unit">قیمت</span>
                                    <span class="price-small-number" style="font-family:IRANSansfaNum !important"> @string.Format("{0:n}", @item.price) </span>
                                    <span class="price-small-unit">تومان</span>

                                </div>

                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="price-small-shop">خرید</span>

                            </div>
                        </div>

                    </div>
                }




            </div>
        </div>


    }
}





@*<div class="list-pagination">

        <nav aria-label="Page navigation example list-pagination-nav">
            <ul class="pagination justify-content-center">
                <li class="page-item disabled">
                    <a class="page-link" href="#" tabindex="-1" aria-disabled="true">بعد</a>
                </li>
                <li class="page-item"><a class="page-link" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item">
                    <a class="page-link" href="#">قبل</a>
                </li>
            </ul>
        </nav>

    </div>*@




<div class="list-pagination">
    @{
        var total = Convert.ToInt32(Model.pageNumber);
        var activ = Convert.ToInt32(Model.currentPage);
        var activminus2 = activ - 2;
        var activminus1 = activ - 1;
        var activplus1 = activ + 1;
        var activplus2 = activ + 2;



        if ((total - activ) > 3 & activ > 3)

        {
            <nav aria-label="Page navigation example list-pagination-nav">
                <ul class="pagination justify-content-center">

                    <li><a class="page-link">«</a></li>
                    <li style="cursor:pointer" class="page-item"><a class="page-link">1</a></li>
                    <li><a class="page-link">...</a></li>
                    <li style="cursor:pointer" class="page-item"><a class="page-link">@activminus2</a></li>
                    <li style="cursor:pointer" class="page-item"><a class="page-link">@activminus1</a></li>
                    <li class="active"><a class="page-link">@activ</a></li>
                    <li style="cursor:pointer" class="page-item"><a class="page-link">@activplus1</a></li>
                    <li style="cursor:pointer" class="page-item"><a class="page-link">@activplus2</a></li>
                    <li> ...</li>
                    <li><a class="page-link">@total</a></li>
                    <li><a class="page-link">»</a></li>
                </ul>
            </nav>

        }
        else if ((total - activ > 3) && !(activ > 3))
        {
            <nav aria-label="Page navigation example list-pagination-nav">
                <ul class="pagination justify-content-center">

                    @for (int i = 1; i < activ; i++)
                    {
                        <li style="cursor:pointer" class="page-item"><a class="page-link">@i</a></li>
                    }
                    <li class="active"><a class="page-link">@activ </a></li>
                    <li style="cursor:pointer" class="page-item"><a class="page-link">@activplus1</a></li>
                    <li style="cursor:pointer" class="page-item"><a class="page-link">@activplus2</a></li>
                    <li><a class="page-link" href="#">...</a></li>
                    <li style="cursor:pointer" class="page-item"><a class="page-link">@total</a></li>
                    <li><a class="page-link" href="#">»</a></li>
                </ul>
            </nav>


        }
        else if (!(total - activ > 3) && activ > 3)
        {
            <nav aria-label="Page navigation example list-pagination-nav">
                <ul class="pagination justify-content-center">

                    <li><a class="page-link">«</a></li>
                    <li style="cursor:pointer" class="page-item"><a class="page-link">1</a></li>
                    <li><a class="page-link">...</a></li>
                    <li style="cursor:pointer" class="page-item"><a class="page-link">@activminus2</a></li>
                    <li style="cursor:pointer" class="page-item"><a class="page-link">@activminus1</a></li>
                    <li style="cursor:pointer" class="active"><a class="page-link">@activ </a></li>
                    @for (int i = activ + 1; i <= total; i++)
                    {
                        <li style="cursor:pointer" class="page-item"><a class="page-link">@i</a></li>
                    }
                    <li><a class="page-link">»</a></li>
                </ul>
            </nav>


        }
        else if (total > 1 && !((total - activ) > 3) && !(activ > 3))
        {
            <nav aria-label="Page navigation example list-pagination-nav">
                <ul class="pagination justify-content-center">

                    @for (int i = 1; i < activ; i++)
                    {
                        <li style="cursor:pointer" class="page-item"><a class="page-link">@i</a></li>
                    }
                    <li class="active"><a class="page-link" href="#">@activ</a></li>
                    @for (int i = activ + 1; i <= total; i++)
                    {
                        <li style="cursor:pointer" class="page-item"><a class="page-link">@i</a></li>
                    }

                </ul>
            </nav>


        }

    }

    <script>
        var getquntity = function () {
            $.ajax({
                url: '/Home/getquntitiy',
                dataType: 'html',
                success: function (data) {
                    var total = 0;
                    var srtcookie = data;

                    if (srtcookie.length > 0) {
                        srtcookie = srtcookie.replace(/&quot;/g, '"');
                        JSON.parse(srtcookie).forEach(function (item) {
                            let valueID = "value" + item.productid;
                            $("." + valueID).text(item.quantity);

                            if (item.quantity == "0") {
                                $("." + valueID).parent().parent().find('.addButton').show();
                                $("." + valueID).parent().parent().find('.addholder').hide();
                            }
                            else {
                                $("." + valueID).parent().parent().find('.addButton').hide();
                                $("." + valueID).parent().parent().find('.addholder').show();
                            }

                            total += parseInt(item.quantity);
                        });
                        $(".simpleCart_quantityy").text(total)

                    } else {
                        $(".simpleCart_quantityy").text("0")
                    };
                }

            })
        };
    </script>
    <script>
        $(".page-item").click(function () {
            var num = this.textContent;
            $.ajax({
                url: '/Home/allpaginationid',
                dataType: 'html',
                data: {
                    id: num,
                },
                success: function (data) {
                   
                    if (data === "1") {
                        $.ajax({
                            url: '/Home/gogetproductlist',
                            dataType: 'html',
                            success: function (data) {

                                $('#productlist').html(data);
                                
                                window.scrollTo(0, 500);
                                getquntity();
                            },
                            error: function () {
                                alert("nashod")
                            },
                            complete: function () {
                                $('#FLTholder').css({ position: 'relative', top: '0px', right: '0px' });
                                $('#spaceholder').css("height", '');
                                $('#SIBdiv').scrollTop();
                                window.scrollTo(0, 0);

                            }
                        });

                    }
                },
                error: function () {

                }

            })
        })

    </script>
    <script>
        var newProductDetail = function (e) {
            window.location.href = "/" + e;

        }
        $(".imageitself").hover(function () {
            var url = $(this).attr('srt2');
            if (url != "") {
                $(this).attr('src', url);
            }


        }, function () {
            var url = $(this).attr('srt1');
            $(this).attr('src', url);
        });
    </script>
    <script>
        $('.value-plus').on('click', function () {

            event.stopPropagation();
            $("#loading").fadeIn()
            let newVal = $(this).parent().children(".value").text();
            if (newVal == "") {
                newVal = "0";
            }
            let finalVal = parseInt(newVal) + 1;
            // $(this).parent().children(".value").text(finalVal);
            var ID = $(this).attr('id');
            let myid = "value" + ID.replace("addtocarto", "");

            $("." + myid).text(finalVal);
            $(this).parent().parent().find('.addButton').hide();
            $(this).parent().parent().find('.addholder').show();

            $.ajax({
                url: '/Home/addtocart',
                dataType: 'html',
                data: {
                    id: ID

                },
                success: function (data) {
                    var value = "value" + ID;

                    var count = parseInt($(".simpleCart_quantityy").text());
                    count += 1;
                    $(".simpleCart_quantityy").text(count);
                    $("#loading").fadeOut();



                },
                error: function () {
                    alert("error")
                }


            });
        });


        $('.value-minus').on('click', function () {
            event.stopPropagation();
            $("#loading").fadeIn()
            var ID = $(this).attr('id');
            let myid = "value" + ID.replace('minus', '');

            let newVal = $(this).parent().children(".value").text();
            let finalVal = "";
            if (newVal != "0") {

                finalVal = parseInt(newVal) - 1;
                $("." + myid).text(finalVal);
            }

            if (finalVal == "0") {
                $(this).parent().parent().find('.addButton').show();
                $(this).parent().parent().find('.addholder').hide();
            }
            else {
                $(this).parent().parent().find('.addButton').hide();
                $(this).parent().parent().find('.addholder').show();
            }

            $.ajax({
                url: '/Home/minusfromcart',
                dataType: 'html',
                data: {
                    id: ID
                },
                success: function (data) {

                    var count = parseInt($(".simpleCart_quantityy").text());
                    count -= 1;
                    $(".simpleCart_quantityy").text(count);
                    $("#loading").fadeOut();



                },
                error: function () {
                    alert("error")
                }


            });





        });




    </script>
    <script>
        getquntity();
    </script>




</div>
